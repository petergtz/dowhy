<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B139P18WHM');
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estimating Confidence Intervals &mdash; DoWhy  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Independence Tests" href="independence_tests.html" />
    <link rel="prev" title="Customizing Causal Mechanism Assignment" href="customizing_model_assignment.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> DoWhy
          </a>
              <div class="version">
                v0.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/intro.html">Introduction to DoWhy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_simple_example.html">Quick-start notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/comparison.html">Comparison to other packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/cite.html">Citing this package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../causality_intro.html">Introduction to causality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../effect_inference/index.html">Effect inference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">GCM-based inference (Experimental)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="answering_causal_questions/index.html">Answering Causal Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="customizing_model_assignment.html">Customizing Causal Mechanism Assignment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Estimating Confidence Intervals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-it">How to use it</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-confidence-intervals-for-causal-queries">Computing confidence intervals for causal queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conveniently-bootstrapping-graph-training-on-random-subsets-of-training-data">Conveniently bootstrapping graph training on random subsets of training data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-cost-versus-confidence">Runtime cost versus confidence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-need-for-confidence-intervals">Understanding the need for confidence intervals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="independence_tests.html">Independence Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/nb_index.html">Example notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials/Case studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/tutorial-causalinference-machinelearning-using-dowhy-econml.html">CATE estimation with DoWhy+EconML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_example_effect_of_memberrewards_program.html">Effect of membership rewards program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/DoWhy-The%20Causal%20Story%20Behind%20Hotel%20Booking%20Cancellations.html">Understanding hotel booking cancellations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing to DoWhy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code_repo.html">Code repository &amp; Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dowhy.html">dowhy package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DoWhy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">GCM-based inference (Experimental)</a> &raquo;</li>
      <li>Estimating Confidence Intervals</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/user_guide/gcm_based_inference/estimating_confidence_intervals.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="estimating-confidence-intervals">
<h1>Estimating Confidence Intervals<a class="headerlink" href="#estimating-confidence-intervals" title="Permalink to this heading"></a></h1>
<p>Our trained generative causal models and specific sample set might not accurately represent the
ground truth and there are typically numerical approximations in our algorithms.
Confidence intervals help us quantify the uncertainty of our results introduced by these
inaccuracies and approximations.</p>
<p>We therefore recommend to use confidence intervals as a default for all causal queries. This avoids
a false sense of confidence in a specific value that might be due to a skewed data set or models
that are not fitted optimally.</p>
<p>To compute confidence intervals, we use a method called <a class="reference external" href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)">bootstrapping</a> and it’s implemented in the
function <a class="reference internal" href="../../dowhy.gcm.html#module-dowhy.gcm.confidence_intervals" title="dowhy.gcm.confidence_intervals"><code class="xref py py-func docutils literal notranslate"><span class="pre">dowhy.gcm.confidence_intervals()</span></code></a>.</p>
<section id="how-to-use-it">
<h2>How to use it<a class="headerlink" href="#how-to-use-it" title="Permalink to this heading"></a></h2>
<p>Let’s say we have a function that <a class="reference external" href="https://www.google.com/search?q=computing+pi+via+monte+carlo">computes Pi using the Monte Carlo method</a> with 1000 trials:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">compute_pi_monte_carlo</span><span class="p">():</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">trials</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">trials</span><span class="p">,))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
<span class="gp">&gt;&gt;&gt; </span>              <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">trials</span><span class="p">,))</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">trials</span>
</pre></div>
</div>
<p>Executing this function will give us a result:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compute_pi_monte_carlo</span><span class="p">()</span>
<span class="go">3.188</span>
</pre></div>
</div>
<p>This looks like a reasonable number, but we can’t tell how reliable that result is, given that it
was computed using a stochastic method. Now, let’s use
<a class="reference internal" href="../../dowhy.gcm.html#module-dowhy.gcm.confidence_intervals" title="dowhy.gcm.confidence_intervals"><code class="xref py py-func docutils literal notranslate"><span class="pre">dowhy.gcm.confidence_intervals()</span></code></a> to compute the confidence interval:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dowhy</span> <span class="kn">import</span> <span class="n">gcm</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">median</span><span class="p">,</span> <span class="n">intervals</span> <span class="o">=</span> <span class="n">gcm</span><span class="o">.</span><span class="n">confidence_intervals</span><span class="p">(</span><span class="n">compute_pi_monte_carlo</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                             <span class="n">num_bootstrap_resamples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">median</span><span class="p">,</span> <span class="n">intervals</span>
<span class="go">(array([3.136]), array([[3.0518, 3.224 ]]))</span>
</pre></div>
</div>
<p>The first item in the result is the median of all results calculated. The second is the interval
in which we are 95% confident that computed values will fall into. By increasing the number of
<code class="docutils literal notranslate"><span class="pre">trials</span></code> we can improve the reliability of <code class="docutils literal notranslate"><span class="pre">compute_pi_monte_carlo</span></code> and hence, narrow the
confidence interval. E.g. with <code class="docutils literal notranslate"><span class="pre">trials</span> <span class="pre">=</span> <span class="pre">10_000</span></code> we get an interval of [3.1132 , 3.16602], with
<code class="docutils literal notranslate"><span class="pre">trials</span> <span class="pre">=</span> <span class="pre">100_000</span></code> we get [3.13256 , 3.150016].</p>
</section>
<section id="computing-confidence-intervals-for-causal-queries">
<h2>Computing confidence intervals for causal queries<a class="headerlink" href="#computing-confidence-intervals-for-causal-queries" title="Permalink to this heading"></a></h2>
<p>With this understanding, we can now apply <code class="docutils literal notranslate"><span class="pre">confidence_intervals</span></code> to one of our causal queries,
e.g. <code class="docutils literal notranslate"><span class="pre">distribution_change</span></code>. Let’s generate some data first:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">halfnorm</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">halfnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="n">halfnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_old</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">halfnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="n">halfnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Z</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">Y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="p">))</span>
</pre></div>
</div>
<p>Here, the causal mechanism for Z changes between the old and new data. As always, next, we’ll model cause-effect
relationships as an SCM and assign causal mechanisms:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">causal_model</span> <span class="o">=</span> <span class="n">gcm</span><span class="o">.</span><span class="n">StructuralCausalModel</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">([(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)]))</span>  <span class="c1"># X -&gt; Z &lt;- Y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gcm</span><span class="o">.</span><span class="n">auto</span><span class="o">.</span><span class="n">assign_causal_mechanisms</span><span class="p">(</span><span class="n">causal_model</span><span class="p">,</span> <span class="n">data_old</span><span class="p">)</span>
</pre></div>
</div>
<p>And now, instead of calling <code class="docutils literal notranslate"><span class="pre">distribution_change</span></code> directly we call it using
<code class="docutils literal notranslate"><span class="pre">confidence_intervals</span></code>. However, since <code class="docutils literal notranslate"><span class="pre">confidence_intervals</span></code> takes a function that takes no
parameters, we must first define a function without parameters:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">gcm</span><span class="o">.</span><span class="n">distribution_change</span><span class="p">(</span><span class="n">causal_model</span><span class="p">,</span> <span class="n">data_old</span><span class="p">,</span> <span class="n">data_new</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And now:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gcm</span><span class="o">.</span><span class="n">confidence_intervals</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">({&#39;X&#39;: 0.0005804787010800414, &#39;Y&#39;: 0.0030143299612704804, &#39;Z&#39;: 0.1724206687905231},</span>
<span class="go">{&#39;X&#39;: array([-0.00427554,  0.00891714]),</span>
<span class="go">&#39;Y&#39;: array([-0.00605089,  0.01782684]),</span>
<span class="go">&#39;Z&#39;: array([0.15441771, 0.19062329])})</span>
</pre></div>
</div>
<p>The result again contains a first item, which is the median values of the contribution scores. The
second item contains the intervals of the contribution scores for each variable.</p>
<p>To avoid defining a new function, we can streamline that call by using a lambda:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gcm</span><span class="o">.</span><span class="n">confidence_intervals</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">gcm</span><span class="o">.</span><span class="n">distribution_change</span><span class="p">(</span><span class="n">causal_model</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                       <span class="n">data_old</span><span class="p">,</span> <span class="n">data_new</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                       <span class="n">target_node</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="conveniently-bootstrapping-graph-training-on-random-subsets-of-training-data">
<h2>Conveniently bootstrapping graph training on random subsets of training data<a class="headerlink" href="#conveniently-bootstrapping-graph-training-on-random-subsets-of-training-data" title="Permalink to this heading"></a></h2>
<p>Many of the causal queries in the GCM package require a trained causal graph as a first argument. To
compute confidence intervals for these methods, we need to explicitly re-train our causal graph
multiple times with different random subsets of data and also run our causal query with each newly
trained graph. To do this conveniently, the GCM package provides a function
<code class="docutils literal notranslate"><span class="pre">bootstrap_training_and_sampling</span></code>. Assuming that we have <code class="docutils literal notranslate"><span class="pre">data</span></code> and a causal graph:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Z</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">X</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">Z</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">causal_model</span> <span class="o">=</span> <span class="n">gcm</span><span class="o">.</span><span class="n">StructuralCausalModel</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">([(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gcm</span><span class="o">.</span><span class="n">auto</span><span class="o">.</span><span class="n">assign_causal_mechanisms</span><span class="p">(</span><span class="n">causal_model</span><span class="p">,</span> <span class="n">data_old</span><span class="p">)</span>
</pre></div>
</div>
<p>we can now use <code class="docutils literal notranslate"><span class="pre">bootstrap_training_and_sampling</span></code> as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">strength_median</span><span class="p">,</span> <span class="n">strength_intervals</span> <span class="o">=</span> <span class="n">gcm</span><span class="o">.</span><span class="n">confidence_intervals</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">gcm</span><span class="o">.</span><span class="n">bootstrap_training_and_sampling</span><span class="p">(</span><span class="n">gcm</span><span class="o">.</span><span class="n">arrow_strength</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                        <span class="n">causal_model</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                        <span class="n">bootstrap_training_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                        <span class="n">target_node</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">strength_median</span><span class="p">,</span> <span class="n">strength_intervals</span>
<span class="go">({(&#39;X&#39;, &#39;Y&#39;): 45.90886398636573, (&#39;Z&#39;, &#39;Y&#39;): 15.47129383737619},</span>
<span class="go">{(&#39;X&#39;, &#39;Y&#39;): array([42.88319632, 50.43890079]), (&#39;Z&#39;, &#39;Y&#39;): array([13.44202416, 17.74266107])})</span>
</pre></div>
</div>
</section>
<section id="runtime-cost-versus-confidence">
<h2>Runtime cost versus confidence<a class="headerlink" href="#runtime-cost-versus-confidence" title="Permalink to this heading"></a></h2>
<p>In certain scenarios it is prohibitely expensive to re-train causal graphs multiple times. E.g. when
using AutoGluon as prediction models for the additive noise model, a single <code class="docutils literal notranslate"><span class="pre">fit</span></code> execution can
quickly go into hours. Bootstrapping with 20 resamples will then quickly go into days depending
on how much we can parallelize.</p>
<p>For that reason, sometimes the tradeoff is to only bootstrap on the causal query, not on the
training. To make this analogous to the approach we used above, there is the function
<code class="xref py py-func docutils literal notranslate"><span class="pre">bootstrap_sampling()</span></code>. This function assumes that the causal graph is already trained. Then
it can be used as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gcm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">causal_model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">strength_median</span><span class="p">,</span> <span class="n">strength_intervals</span> <span class="o">=</span> <span class="n">gcm</span><span class="o">.</span><span class="n">confidence_intervals</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">gcm</span><span class="o">.</span><span class="n">bootstrap_sampling</span><span class="p">(</span><span class="n">gcm</span><span class="o">.</span><span class="n">arrow_strength</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">causal_model</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">target_node</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">strength_median</span><span class="p">,</span> <span class="n">strength_intervals</span>
<span class="go">({(&#39;X&#39;, &#39;Y&#39;): 46.07299374572871, (&#39;Z&#39;, &#39;Y&#39;): 15.358850280972195},</span>
<span class="go">{(&#39;X&#39;, &#39;Y&#39;): array([44.95914495, 47.63918151]), (&#39;Z&#39;, &#39;Y&#39;): array([15.04323069, 15.72570547])})</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">dowhy.gcm.bootstrap_sampling()</span></code> accomplishes the same thing as the lambda we’ve seen earlier. However,
using <code class="docutils literal notranslate"><span class="pre">bootstrap_sampling</span></code> is more expressive. We therefore recommend its use over a lambda for
all causal queries that take a causal graph as the first argument.</p>
</section>
<section id="understanding-the-need-for-confidence-intervals">
<h2>Understanding the need for confidence intervals<a class="headerlink" href="#understanding-the-need-for-confidence-intervals" title="Permalink to this heading"></a></h2>
<p>As explained in the beginnging, the models and specific sample set might not accurately represent
the ground truth and there are typically numerical approximations in our algorithms. The error
comes from three sources:</p>
<ul class="simple">
<li><p>Variance of the “optimal” parameters for a model, i.e. running <code class="docutils literal notranslate"><span class="pre">fit</span></code> twice with the
same/slightly different data can yield two different models (becomes even worse when there is a
stochastic element in the fit process of the prediction models as well). For instance, training an
AutoGluon model twice on even exactly the same data would return two different models with
slightly different performance.</p></li>
<li><p>Approximations in our algorithms. For instance, when estimating distribution change with 6+
upstream nodes, we will only approximate the Shapley values (the approximation has a stochastic
factor). Therefore, running distribution change twice with exactly the same input and generated
samples will return two different results.</p></li>
<li><p>Even if we do not approximate the Shapley values, the algorithms are typically based on some
specific samples from the generative models, i.e. variance can also come from the variance between
two sets of drawn samples. Therefore, even if the algorithm itself is deterministic (e.g. evaluate
all possible subsets for the Shapley values), we would use randomly generated samples which yields
different results when calling an algorithm twice.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="customizing_model_assignment.html" class="btn btn-neutral float-left" title="Customizing Causal Mechanism Assignment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="independence_tests.html" class="btn btn-neutral float-right" title="Independence Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, PyWhy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.8
    <span class="fa fa-caret-down"></span>
  </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Releases</dt>
            <dd><a href="../../../v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
            <dd><a href="../../../v0.2/index.html">v0.2</a></dd>
            <dd><a href="../../../v0.4/index.html">v0.4</a></dd>
            <dd><a href="../../../v0.5/index.html">v0.5</a></dd>
            <dd><a href="../../../v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="../../../v0.6/index.html">v0.6</a></dd>
            <dd><a href="../../../v0.7/index.html">v0.7</a></dd>
            <dd><a href="../../../v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="estimating_confidence_intervals.html">v0.8</a></dd>
            <!-- TODO: add mechanism to add new version here. Probably just render them in from generate_docs.sh. -->
        </dl>
        <dl>
            <dt>Branches</dt>
            <!-- hard-coding the link to main -->
            <!-- It would be nice if this opened the same page on main branch, but that seems to be overkill
                 right now. Therefore defaulting to the starting page (index). -->
            <dd><a href="/dowhy/main/index.html">main</a></dd>
        </dl>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>