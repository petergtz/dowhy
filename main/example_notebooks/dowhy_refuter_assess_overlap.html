
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B139P18WHM');
    </script>
    
    <title>Assessing Support and Overlap with OverRule &#8212; DoWhy  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    <img src="../_static/dowhy-logo-small.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/dowhy-logo-small.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting_started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="nb_index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../dowhy.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../code_repo.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        main
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Assessing Support and Overlap with OverRule
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Motivation">
     Motivation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Acknowledgements">
     Acknowledgements
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Table-of-contents">
   Table of contents
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Illustration-on-a-simple-2D-example">
   Illustration on a simple 2D example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Problem-Data">
     Problem Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Applying-OverRule-with-default-arguments">
     Applying OverRule with default arguments
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Example-usage-using-CausalModel">
       Example usage using CausalModel
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Example-usage-using-the-Functional-API">
       Example usage using the Functional API
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Only-fitting-support-or-overlap-rules">
       Only fitting support or overlap rules
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Interpreting-the-output-of-OverRule">
     Interpreting the output of OverRule
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Configuring-OverRule">
     Configuring OverRule
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Illustration-on-Lalonde-and-PSID-datasets">
   Illustration on Lalonde and PSID datasets
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Checking-for-Support/Overlap-in-the-Experimental-Sample">
     Checking for Support/Overlap in the Experimental Sample
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Assessing-Support/Overlap-on-the-combined-sample">
     Assessing Support/Overlap on the combined sample
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Filtering-with-OverRule-before-performing-a-causal-analysis">
     Filtering with OverRule before performing a causal analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Performing-causal-inference-after-filtering">
     Performing causal inference after filtering
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Assessing-Support-and-Overlap-with-OverRule">
<h1>Assessing Support and Overlap with OverRule<a class="headerlink" href="#Assessing-Support-and-Overlap-with-OverRule" title="Permalink to this heading"></a></h1>
<section id="Motivation">
<h2>Motivation<a class="headerlink" href="#Motivation" title="Permalink to this heading"></a></h2>
<p>When performing backdoor adjustment, even if we correctly specify the causal graph and observe all the relevant variables <span class="math notranslate nohighlight">\(X\)</span> for backdoor adjustment, we can only estimate causal effects for individuals with covariates <span class="math notranslate nohighlight">\(X\)</span> that satisfy two conditions: * Support: Simply put, we require that we observe similar individuals in our dataset. For discrete covariates <span class="math notranslate nohighlight">\(X\)</span>, this can be formalized as requiring that</p>
<div class="math notranslate nohighlight">
\[P(X) &gt; 0\]</div>
<p>* Overlap: We require that there is some possibility of observing both the treatment and control for similar individuals. Formally, we require that</p>
<div class="math notranslate nohighlight">
\[1 &gt; P(T = 1 \mid X) &gt; 0\]</div>
<p>OverRule [1] is a method for learning Boolean Rule Sets that characterize the set of individuals who satisfy both conditions, and is demonstrated in this notebook on some simple examples to build intuition.</p>
</section>
<section id="Acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#Acknowledgements" title="Permalink to this heading"></a></h2>
<p>Code for OverRule is adapted (with minimal modifications, but some simplifications) from <a class="reference external" href="https://github.com/clinicalml/overlap-code">https://github.com/clinicalml/overlap-code</a>, under the MIT License.</p>
<p>[1] Oberst, M., Johansson, F., Wei, D., Gao, T., Brat, G., Sontag, D., &amp; Varshney, K. (2020). Characterization of Overlap in Observational Studies. In S. Chiappa &amp; R. Calandra (Eds.), Proceedings of the Twenty Third International Conference on Artificial Intelligence and Statistics (Vol. 108, pp. 788–798). PMLR. <a class="reference external" href="https://arxiv.org/abs/1907.04138">https://arxiv.org/abs/1907.04138</a></p>
</section>
</section>
<section id="Table-of-contents">
<h1>Table of contents<a class="headerlink" href="#Table-of-contents" title="Permalink to this heading"></a></h1>
<ol class="arabic simple">
<li><p><a class="reference external" href="#2dexample">Illustration on a simple 2D example</a></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#2d_problemdata">Problem Data</a></p></li>
<li><p><a class="reference external" href="#2d_applyingOverRule">Applying OverRule with default arguments</a></p></li>
<li><p><a class="reference external" href="#2d_interpret_output">Interpreting the output of OverRule</a></p></li>
<li><p><a class="reference external" href="#2d_configuration">Configuring OverRule</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#lalonde%22">Illustration on Lalonde and PSID datasets</a></p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import pandas as pd

import dowhy.datasets
from dowhy import CausalModel
# Functional API
from dowhy.causal_refuters.assess_overlap import assess_support_and_overlap_overrule

# Data classes to configure ruleset optimization
from dowhy.causal_refuters.assess_overlap_overrule import SupportConfig, OverlapConfig

import matplotlib.pyplot as plt
</pre></div>
</div>
</div>
</section>
<section id="Illustration-on-a-simple-2D-example">
<h1>Illustration on a simple 2D example<a class="headerlink" href="#Illustration-on-a-simple-2D-example" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="#toc">Back to Table of Contents</a></p>
<section id="Problem-Data">
<h2>Problem Data<a class="headerlink" href="#Problem-Data" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="#toc">Back to Table of Contents</a></p>
<p>In this example, we have a pair of binary covariates <span class="math notranslate nohighlight">\(X_1, X_2\)</span>, with simple violations of the above conditions: * Support: There are no samples where <span class="math notranslate nohighlight">\(X_1 = X_2 = 1\)</span>, i.e., <span class="math notranslate nohighlight">\(P(X_1 = 1, X_2 = 1) = 0\)</span> * Overlap: Only individuals with <span class="math notranslate nohighlight">\(X_1 = 0, X_2 = 0\)</span> have a chance of recieving both treatment <span class="math notranslate nohighlight">\((T = 1)\)</span> and control <span class="math notranslate nohighlight">\((T = 0)\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>test_data = pd.DataFrame(
        np.array(
            [
                [0, 0, 1, 1],
                [0, 0, 0, 0],
                [0, 1, 1, 0],
                [1, 0, 0, 0],
            ]
            * 50
        ),
        columns=[&quot;X1&quot;, &quot;X2&quot;, &quot;T&quot;, &quot;Y&quot;],
    )
</pre></div>
</div>
</div>
<p>We can visualize these patterns as follows, where we <strong>add some jitter</strong> to the values to makes things easier to see</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>rng = np.random.default_rng(0)
jitter_data = test_data.copy()
jitter_data[&#39;X1&#39;] = jitter_data[&#39;X1&#39;] + rng.normal(0, 0.05, size=(200,))
jitter_data[&#39;X2&#39;] = jitter_data[&#39;X2&#39;] + rng.normal(0, 0.05, size=(200,))

fig, ax = plt.subplots(1, 1, figsize=(5, 5))
for t in [0, 1]:
    this_data = jitter_data.query(&#39;T == @t&#39;)
    ax.scatter(this_data[&#39;X1&#39;], this_data[&#39;X2&#39;], label=f&#39;T = {t}&#39;, edgecolor=&#39;w&#39;, linewidths=0.5)

plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_dowhy_refuter_assess_overlap_7_0.png" src="../_images/example_notebooks_dowhy_refuter_assess_overlap_7_0.png" />
</div>
</div>
<p>Notice how the only region where overlap holds is when <span class="math notranslate nohighlight">\(X_1 = X_2 = 0\)</span>.</p>
</section>
<section id="Applying-OverRule-with-default-arguments">
<h2>Applying OverRule with default arguments<a class="headerlink" href="#Applying-OverRule-with-default-arguments" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="#toc">Back to Table of Contents</a></p>
<p>This method is currently implemented as a refutation method, though it can also be accessed through the functional API. We illustrate both methods below, before discussing their arguments.</p>
<p>Note that OverRule returns rules in Disjunctive Normal Form (DNF), which can be read as an OR of ANDs, and are given when <code class="docutils literal notranslate"><span class="pre">print(refute)</span></code> is called.</p>
<section id="Example-usage-using-CausalModel">
<h3>Example usage using CausalModel<a class="headerlink" href="#Example-usage-using-CausalModel" title="Permalink to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = CausalModel(
    data=test_data,
    treatment=&quot;T&quot;,
    outcome=&quot;Y&quot;,
    common_causes=[&#39;X1&#39;, &#39;X2&#39;]
)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>identified_estimand = model.identify_effect(proceed_when_unidentifiable=True)

estimate = model.estimate_effect(identified_estimand, method_name=&quot;backdoor.linear_regression&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># We disucss configuration in more depth below.
support_config = SupportConfig(seed=0)
overlap_config = OverlapConfig()
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>refute = model.refute_estimate(
    identified_estimand,
    estimate,
    method_name=&#39;assess_overlap&#39;,
    support_config=support_config,
    overlap_config=overlap_config,
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(refute)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rules cover 50.0% of all samples
Overall, 50.0% of samples meet the criteria for inclusion in the overlap set,
defined as (a) being covered by support rules and having propensity
score in (0.10, 0.90)
Rules capture 100.0% of samples which meet these criteria

How to read rules: The following rules are given in Disjuntive Normal Form,
a series of AND clauses (e.g., X and Y and Z) joined by ORs. Hence, if a sample
 satifies any of the clauses for the support rules, it is included in the support,
and likewise for the overlap rules.

DETAILED RULES:
SUPPORT Rules: Found 2 rule(s), covering 100.0% of samples
            Rule #0: (not X1)
                 [Covers 75.0% of samples]
         OR Rule #1: (X1)
                 AND (not X2)
                 [Covers 25.0% of samples]
OVERLAP Rules: Found 1 rule(s), covering 50.0% of samples
            Rule #0: (not X1)
                 AND (not X2)
                 [Covers 50.0% of samples]

</pre></div></div>
</div>
</section>
<section id="Example-usage-using-the-Functional-API">
<h3>Example usage using the Functional API<a class="headerlink" href="#Example-usage-using-the-Functional-API" title="Permalink to this heading"></a></h3>
<p>Note that the outcome <span class="math notranslate nohighlight">\(Y\)</span> is not used as part of OverRule, so it is not required here.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>refute = assess_support_and_overlap_overrule(
    data=test_data,
    backdoor_vars=[&#39;X1&#39;, &#39;X2&#39;],
    treatment_name=&#39;T&#39;,
    support_config=support_config,
    overlap_config=overlap_config
)
</pre></div>
</div>
</div>
</section>
<section id="Only-fitting-support-or-overlap-rules">
<h3>Only fitting support or overlap rules<a class="headerlink" href="#Only-fitting-support-or-overlap-rules" title="Permalink to this heading"></a></h3>
<p>You can also run OverRule to <strong>only</strong> learn either support or overlap rules, by passing in either <code class="docutils literal notranslate"><span class="pre">support_only=True</span></code> or <code class="docutils literal notranslate"><span class="pre">overlap_only=True</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>refute = model.refute_estimate(
    identified_estimand,
    estimate,
    method_name=&#39;assess_overlap&#39;,
    support_only=True,
    support_config=support_config,
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(refute)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rules cover 100.0% of all samples

How to read rules: The following rules are given in Disjuntive Normal Form,
a series of AND clauses (e.g., X and Y and Z) joined by ORs. Hence, if a sample
 satifies any of the clauses for the support rules, it is included in the support,
and likewise for the overlap rules.

DETAILED RULES:
SUPPORT Rules: Found 2 rule(s), covering 100.0% of samples
            Rule #0: (not X1)
                 [Covers 75.0% of samples]
         OR Rule #1: (X1)
                 AND (not X2)
                 [Covers 25.0% of samples]
No Overlap Rules Fitted (support_only=True).
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>refute = model.refute_estimate(
    identified_estimand,
    estimate,
    method_name=&#39;assess_overlap&#39;,
    overlap_only=True,
    overlap_config=overlap_config
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(refute)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rules cover 50.0% of all samples
Overall, 50.0% of samples meet the criteria for inclusion in the overlap set,
defined as (a) being covered by support rules and having propensity
score in (0.10, 0.90)
Rules capture 100.0% of samples which meet these criteria

How to read rules: The following rules are given in Disjuntive Normal Form,
a series of AND clauses (e.g., X and Y and Z) joined by ORs. Hence, if a sample
 satifies any of the clauses for the support rules, it is included in the support,
and likewise for the overlap rules.

DETAILED RULES:
No Support Rules Fitted (overlap_only=True).
OVERLAP Rules: Found 1 rule(s), covering 50.0% of samples
            Rule #0: (not X1)
                 AND (not X2)
                 [Covers 50.0% of samples]

</pre></div></div>
</div>
</section>
</section>
<section id="Interpreting-the-output-of-OverRule">
<h2>Interpreting the output of OverRule<a class="headerlink" href="#Interpreting-the-output-of-OverRule" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="#toc">Back to Table of Contents</a></p>
<p>We will use the following set of rules to illustrate how to interpret the output.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SUPPORT Rules: Found 2 rule(s), covering 100.0% of samples
        Rule #0: (not X1)
             [Covers 75.0% of samples]
     OR Rule #1: (X1)
             AND (not X2)
             [Covers 25.0% of samples]
OVERLAP Rules: Found 1 rule(s), covering 50.0% of samples
        Rule #0: (not X2)
             AND (not X1)
             [Covers 50.0% of samples]
</pre></div>
</div>
<p>For any sample, we can check if the sample is covered by the support by checking each rule (Rule 0 and Rule 1). The sample is in the support if ANY of these rules apply. Consider a point (X1 = 1, X2 = 1), which we know is not in the support of our original data. Since each binary input is treated as a boolean, we can check: * Rule 0: (not X1) –&gt; This rule is not satisfied by (X1 = 1, X2 = 1), because X1 = 1 is equivalent to X2 = True * Rule 1: (X1) AND (not X2) –&gt; This rule is not satisfied,
because X2 = 1</p>
<p>Similarly, we can check if a sample is covered by the overlap rules. Consider the point (X1 = 1, X2 = 0). This satisfies the support rules because it matches Rule 0. For the overlap rules, however, we can check: * Rule 0: (not X2) AND (not X1) –&gt; This rule is not satisfied, because X1 = 1.</p>
<p><strong>Note</strong>: When we later filter samples based on the rules learned by OverRule, we will filter out any samples that do not match BOTH a support rule, and an overlap rule.</p>
</section>
<section id="Configuring-OverRule">
<h2>Configuring OverRule<a class="headerlink" href="#Configuring-OverRule" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="#toc">Back to Table of Contents</a></p>
<p>OverRule can be configured by passing in the following arguments * <code class="docutils literal notranslate"><span class="pre">overlap_eps</span></code>: This should be a number <span class="math notranslate nohighlight">\(\epsilon\)</span> in (0, 0.5) which defines the overlap region as those points where <span class="math notranslate nohighlight">\(P(T = 1 \mid X)\)</span> is in <span class="math notranslate nohighlight">\((\epsilon, 1 - \epsilon)\)</span>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cat_feats</span></code>: A list of any categorical features (automatically inferred if dtype is object).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">support_config</span></code>: A <code class="docutils literal notranslate"><span class="pre">SupportConfig</span></code> (see below), which controls optimization parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">overlap_config</span></code>: An <code class="docutils literal notranslate"><span class="pre">OverlapConfig</span></code> (see below), which controls optimization parameters</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>support_config = SupportConfig()
print(support_config)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SupportConfig(n_ref_multiplier=1.0, seed=None, alpha=0.98, lambda0=0.01, lambda1=0.001, K=20, D=20, B=10, iterMax=10, num_thresh=9, thresh_override=None, solver=&#39;ECOS&#39;, rounding=&#39;greedy_sweep&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>overlap_config = OverlapConfig()
print(overlap_config)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OverlapConfig(alpha=0.95, lambda0=0.001, lambda1=0.001, K=20, D=20, B=10, iterMax=10, num_thresh=9, thresh_override=None, solver=&#39;ECOS&#39;, rounding=&#39;greedy_sweep&#39;)
</pre></div></div>
</div>
<p><strong>Key Parameters</strong>: For <code class="docutils literal notranslate"><span class="pre">SupportConfig</span></code> and <code class="docutils literal notranslate"><span class="pre">OverlapConfig</span></code>, the defaults are generally sensible, but some may be worth changing depending on the problem, and are detailed below.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code>:</p>
<ul>
<li><p>For learning support rules, we require that at least an <code class="docutils literal notranslate"><span class="pre">alpha</span></code> fraction of the original data is included, while minimizing the volume of the resulting support set.</p></li>
<li><p>For learning overlap rules, at least an <code class="docutils literal notranslate"><span class="pre">alpha</span></code> fraction of the “overlap points” must be included, while excluding as many non-overlap points as possible. Here, the “overlap points” are defined as those where <span class="math notranslate nohighlight">\(P(T = 1 \mid X)\)</span> is within <code class="docutils literal notranslate"><span class="pre">[overlap_eps,</span> <span class="pre">1</span> <span class="pre">-</span> <span class="pre">overlap_eps]</span></code>, estimated using an XGBClassifier.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lambda0</span></code>, <code class="docutils literal notranslate"><span class="pre">lambda1</span></code>: These are regularization terms which control the complexity of the final rules.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lambda0</span></code> is a penalty added for every new rule (which can contain multiple literals). For instance, <code class="docutils literal notranslate"><span class="pre">(not</span> <span class="pre">X1)</span> <span class="pre">AND</span> <span class="pre">(not</span> <span class="pre">X2)</span></code> is a single rule.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lambda1</span></code> is a penalty added for every literal. For instance, <code class="docutils literal notranslate"><span class="pre">(not</span> <span class="pre">X1)</span> <span class="pre">AND</span> <span class="pre">(not</span> <span class="pre">X2)</span></code> contains two literals.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_thresh</span></code>: OverRule turns all features into binary rules before learning rulesets. For continuous variables, it does so (by default) by converting into deciles. This default behavior can be changed via changing the number of thresholds, or specifying a dictionary (in <code class="docutils literal notranslate"><span class="pre">thresh_override</span></code>) that maps features to a <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> of thresholds.</p></li>
</ul>
</section>
</section>
<section id="Illustration-on-Lalonde-and-PSID-datasets">
<h1>Illustration on Lalonde and PSID datasets<a class="headerlink" href="#Illustration-on-Lalonde-and-PSID-datasets" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="#toc">Back to Table of Contents</a></p>
<p>In this section, we show how OverRule can be applied in the course of doing another causal analysis. Here, we demonstrate both * Using OverRule prior to conducting analysis * Filtering samples using the learned rules</p>
<p>Incorporating OverRule into a causal inference workflow looks like * First, applying OverRule to learn rules, before any causal effect estimation is performed * Second, filtering samples according to the learned rules * Third, estimating causal effects on the filtered sample</p>
<p>For this illustration, we use two datasets to construct a somewhat artificial causal inference task: * The original dataset from Lalonde (1986), which contains experimental samples, and which is loaded via <code class="docutils literal notranslate"><span class="pre">dowhy.datasets.lalonde_dataset()</span></code>. Because this is an <em>experimental</em> sample, we will see that <strong>overlap holds for all the samples in this sample.</strong> * An observational dataset consisting entirely of non-treated samples, the PSID dataset, which was analyzed in Smith &amp; Todd (2005) in
conjunction with the original experimental dataset. This is loaded from <code class="docutils literal notranslate"><span class="pre">dowhy.datasets.psid_dataset()</span></code></p>
<p>By merging these datasets and then assessing overlap, we find that <strong>in the combined dataset, overlap only holds for ~30% of samples.</strong> Intuitively, many of the samples from the PSID are excluded, due to the restrictive inclusion criteria on the original experiment.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pandas as pd

import dowhy.datasets
from dowhy.causal_refuters.assess_overlap import assess_support_and_overlap_overrule
from dowhy.causal_refuters.assess_overlap_overrule import OverlapConfig, SupportConfig

# Experimental sample from Lalonde
experiment_data = dowhy.datasets.lalonde_dataset()

# Observational sample
observational_controls = dowhy.datasets.psid_dataset()

experiment_data[&quot;exp_samp&quot;] = True
observational_controls[&quot;exp_samp&quot;] = False

data = pd.concat([experiment_data, observational_controls], axis=0, ignore_index=True)

support_config = SupportConfig(seed=0, lambda0=0.01, lambda1=0.01)
overlap_config = OverlapConfig(lambda0=0.01, lambda1=0.01)
</pre></div>
</div>
</div>
<p>Before running any causal analysis, we first check for support and overlap. Note that the default setting for <code class="docutils literal notranslate"><span class="pre">alpha</span></code> is 0.98, which means that * The support rules will try to cover at least 98% (<code class="docutils literal notranslate"><span class="pre">alpha</span></code>) of the data with a minimum volume set * The overlap rules will try to cover at least 98% (<code class="docutils literal notranslate"><span class="pre">alpha</span></code>) of the samples which have propensity scores in <code class="docutils literal notranslate"><span class="pre">[overlap_eps,</span> <span class="pre">1-overlap_eps]</span></code></p>
<section id="Checking-for-Support/Overlap-in-the-Experimental-Sample">
<h2>Checking for Support/Overlap in the Experimental Sample<a class="headerlink" href="#Checking-for-Support/Overlap-in-the-Experimental-Sample" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>refute_experiment = assess_support_and_overlap_overrule(
    data=experiment_data,
    backdoor_vars=&quot;nodegr+black+hisp+age+educ+married+re74+re75&quot;.split(&quot;+&quot;),
    treatment_name=&quot;treat&quot;,
    support_config=support_config,
    overlap_config=overlap_config,
)

# Observe how everyone is in the overlap set, so we do not learn any overlap rules
print(refute_experiment)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
All samples in the support region satisfy the overlap condition.
No Overlap Rules will be learned.
Rules cover 98.9% of all samples

How to read rules: The following rules are given in Disjuntive Normal Form,
a series of AND clauses (e.g., X and Y and Z) joined by ORs. Hence, if a sample
 satifies any of the clauses for the support rules, it is included in the support,
and likewise for the overlap rules.

DETAILED RULES:
SUPPORT Rules: Found 4 rule(s), covering 98.9% of samples
            Rule #0: ([re74 &lt;= 0.000])
                 [Covers 73.3% of samples]
         OR Rule #1: (black)
                 AND (not hisp)
                 AND ([age &lt;= 35.000])
                 AND ([educ &lt;= 12.000])
                 [Covers 71.5% of samples]
         OR Rule #2: (not married)
                 AND ([re74 &lt;= 7838.192])
                 AND ([re75 &lt;= 5146.040])
                 [Covers 73.7% of samples]
         OR Rule #3: (not black)
                 AND ([age &lt;= 30.000])
                 AND ([educ &lt;= 12.000])
                 AND ([educ &gt; 8.000])
                 [Covers 10.6% of samples]
No Overlap Rules Fitted (support_only=True).
</pre></div></div>
</div>
<p><strong>Note</strong>: As demonstrated above, if OverRule finds that all samples satisfy the overlap condition, then it will not bother to learn separate Overlap rules.</p>
</section>
<section id="Assessing-Support/Overlap-on-the-combined-sample">
<h2>Assessing Support/Overlap on the combined sample<a class="headerlink" href="#Assessing-Support/Overlap-on-the-combined-sample" title="Permalink to this heading"></a></h2>
<p>Now, analyzing the combined dataset, we find a substantial lack of overlap</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>var_list = &quot;nodegr+black+hisp+age+educ+married+re74+re75&quot;.split(&quot;+&quot;)
refute = assess_support_and_overlap_overrule(
    data=data,
    backdoor_vars=var_list,
    treatment_name=&quot;treat&quot;,
    support_config=support_config,
    overlap_config=overlap_config,
)
print(refute)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rules cover 34.6% of all samples
Overall, 31.2% of samples meet the criteria for inclusion in the overlap set,
defined as (a) being covered by support rules and having propensity
score in (0.10, 0.90)
Rules capture 96.8% of samples which meet these criteria

How to read rules: The following rules are given in Disjuntive Normal Form,
a series of AND clauses (e.g., X and Y and Z) joined by ORs. Hence, if a sample
 satifies any of the clauses for the support rules, it is included in the support,
and likewise for the overlap rules.

DETAILED RULES:
SUPPORT Rules: Found 2 rule(s), covering 98.1% of samples
            Rule #0: ([re74 &lt;= 33307.536])
                 AND ([re75 &lt;= 32691.290])
                 [Covers 87.6% of samples]
         OR Rule #1: (not nodegr)
                 AND (not hisp)
                 AND ([educ &gt; 11.000])
                 [Covers 60.6% of samples]
OVERLAP Rules: Found 5 rule(s), covering 35.3% of samples
            Rule #0: ([re74 &lt;= 1282.723])
                 [Covers 20.0% of samples]
         OR Rule #1: ([re75 &lt;= 716.129])
                 [Covers 20.1% of samples]
         OR Rule #2: (black)
                 AND (not married)
                 [Covers 15.2% of samples]
         OR Rule #3: (not nodegr)
                 AND ([re74 &lt;= 7837.067])
                 [Covers 12.2% of samples]
         OR Rule #4: ([age &lt;= 26.000])
                 AND ([educ &gt; 11.000])
                 AND ([re75 &lt;= 11637.097])
                 [Covers 7.7% of samples]

</pre></div></div>
</div>
</section>
<section id="Filtering-with-OverRule-before-performing-a-causal-analysis">
<h2>Filtering with OverRule before performing a causal analysis<a class="headerlink" href="#Filtering-with-OverRule-before-performing-a-causal-analysis" title="Permalink to this heading"></a></h2>
<p>OverRule can take any dataframe with the same columns as the original dataframe, and filter down to units that are included in both the support and overlap region.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bool_mask = refute.predict_overlap_support(data)

# This is a simple wrapper around refute.predict_overlap_support
filtered_df = refute.filter_dataframe(data).copy()

assert np.array_equal(data[bool_mask], filtered_df)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bool_mask.mean()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$\displaystyle 0.345826235093697$</div></div>
</div>
</section>
<section id="Performing-causal-inference-after-filtering">
<h2>Performing causal inference after filtering<a class="headerlink" href="#Performing-causal-inference-after-filtering" title="Permalink to this heading"></a></h2>
<p>Suppose that we were only given the combined sample, and wanted to perform causal effect estimation. Having used OverRule to characterize the Support/Overlap region, we can now filter the data and perform analysis on the reduced dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Note that we are using the filtered_df here
model = CausalModel(
        data = filtered_df,
        treatment=&#39;treat&#39;,
        outcome=&#39;re78&#39;,
        common_causes=&quot;nodegr+black+hisp+age+educ+married+re74+re75&quot;.split(&quot;+&quot;)
)
identified_estimand = model.identify_effect(proceed_when_unidentifiable=True)

estimate = model.estimate_effect(identified_estimand,
        method_name=&quot;backdoor.propensity_score_weighting&quot;,
        target_units=&quot;ate&quot;,
        method_params={&quot;weighting_scheme&quot;:&quot;ips_weight&quot;})

print(&quot;Causal Estimate is &quot; + str(estimate.value))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Causal Estimate is -958.9002273474416
</pre></div></div>
</div>
<p><strong>Disclaimer</strong>: This is just an illustration of how to incorporate OverRule into a causal inference workflow. However, the task itself is somewhat artificial: Here, we have combined experimental data (from Lalonde) with observational data (from PSID), which can introduce bias into our estimates. We only do so here to demonstrate that OverRule can pick up on a lack of overlap between treatment and control in the combined sample.</p>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PyWhy contributors.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>