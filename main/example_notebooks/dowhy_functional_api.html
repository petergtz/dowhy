
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B139P18WHM');
    </script>
    
    <title>Functional API Preview &#8212; DoWhy  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">DoWhy  documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting_started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="nb_index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../dowhy.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../code_repo.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Functional API Preview
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Import-Dependencies">
     Import Dependencies
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Create-the-Datasets">
     Create the Datasets
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Identify-Effect---Functional-API-(Preview)">
     Identify Effect - Functional API (Preview)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Estimate-Effect---Functional-API-(Preview)">
     Estimate Effect - Functional API (Preview)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Refute-Estimate---Functional-API-(Preview)">
     Refute Estimate - Functional API (Preview)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Backwards-Compatibility">
   Backwards Compatibility
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Identify-Effect">
     Identify Effect
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Estimate-Effect">
     Estimate Effect
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Refute-Estimate">
     Refute Estimate
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Functional-API-Preview">
<h1>Functional API Preview<a class="headerlink" href="#Functional-API-Preview" title="Permalink to this heading"></a></h1>
<p>This notebook is part of a set of notebooks that provides a preview of the proposed functional API for dowhy. For details on the new API for DoWhy, check out <a class="reference external" href="https://github.com/py-why/dowhy/wiki/API-proposal-for-v1">https://github.com/py-why/dowhy/wiki/API-proposal-for-v1</a> It is a work-in-progress and is updated as we add new functionality. We welcome your feedback through Discord or on the Discussions page. This functional API is designed with backwards compatibility. So both the old and new API will continue to co-exist and work for the immediate new
releases. Gradually the old API using CausalModel will be deprecated in favor of the new API.</p>
<p>The current Functional API covers: * Identify Effect: * <code class="docutils literal notranslate"><span class="pre">identify_effect(...)</span></code>: Run the identify effect algorithm using defaults just provide the graph, treatment and outcome. * <code class="docutils literal notranslate"><span class="pre">auto_identify_effect(...)</span></code>: More configurable version of <code class="docutils literal notranslate"><span class="pre">identify_effect(...)</span></code>. * <code class="docutils literal notranslate"><span class="pre">id_identify_effect(...)</span></code>: Identify Effect using the ID-Algorithm. * Refute Estimate: * <code class="docutils literal notranslate"><span class="pre">refute_estimate</span></code>: Function to run a set of the refuters below with the default parameters. * <code class="docutils literal notranslate"><span class="pre">refute_bootstrap</span></code>: Refute an
estimate by running it on a random sample of the data containing measurement error in the confounders. * <code class="docutils literal notranslate"><span class="pre">refute_data_subset</span></code>: Refute an estimate by rerunning it on a random subset of the original data. * <code class="docutils literal notranslate"><span class="pre">refute_random_common_cause</span></code>: Refute an estimate by introducing a randomly generated confounder (that may have been unobserved). * <code class="docutils literal notranslate"><span class="pre">refute_placebo_treatment</span></code>: Refute an estimate by replacing treatment with a randomly-generated placebo variable. * <code class="docutils literal notranslate"><span class="pre">sensitivity_simulation</span></code>: Add an
unobserved confounder for refutation (Simulation of an unobserved confounder). * <code class="docutils literal notranslate"><span class="pre">sensitivity_linear_partial_r2</span></code>: Add an unobserved confounder for refutation (Linear partial R2 : Sensitivity Analysis for linear models). * <code class="docutils literal notranslate"><span class="pre">sensitivity_non_parametric_partial_r2</span></code>: Add an unobserved confounder for refutation (Non-Parametric partial R2 based : Sensitivity Analyis for non-parametric models). * <code class="docutils literal notranslate"><span class="pre">sensitivity_e_value</span></code>: Computes E-value for point estimate and confidence limits. Benchmarks
E-values against measured confounders using Observed Covariate E-values. Plots E-values and Observed Covariate E-values. * <code class="docutils literal notranslate"><span class="pre">refute_dummy_outcome</span></code>: Refute an estimate by introducing a randomly generated confounder (that may have been unobserved).</p>
<section id="Import-Dependencies">
<h2>Import Dependencies<a class="headerlink" href="#Import-Dependencies" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Functional API imports</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_identifier</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BackdoorAdjustment</span><span class="p">,</span>
    <span class="n">EstimandType</span><span class="p">,</span>
    <span class="n">identify_effect</span><span class="p">,</span>
    <span class="n">identify_effect_auto</span><span class="p">,</span>
    <span class="n">identify_effect_id</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># import effect identifier</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_refuters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">refute_bootstrap</span><span class="p">,</span>
    <span class="n">refute_data_subset</span><span class="p">,</span>
    <span class="n">refute_random_common_cause</span><span class="p">,</span>
    <span class="n">refute_placebo_treatment</span><span class="p">,</span>
    <span class="n">sensitivity_e_value</span><span class="p">,</span>
    <span class="n">sensitivity_linear_partial_r2</span><span class="p">,</span>
    <span class="n">sensitivity_non_parametric_partial_r2</span><span class="p">,</span>
    <span class="n">sensitivity_simulation</span><span class="p">,</span>
    <span class="n">refute_dummy_outcome</span><span class="p">,</span>
    <span class="n">refute_estimate</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># import refuters</span>

<span class="kn">from</span> <span class="nn">dowhy.causal_estimators.propensity_score_matching_estimator</span> <span class="kn">import</span> <span class="n">PropensityScoreMatchingEstimator</span>

<span class="kn">from</span> <span class="nn">dowhy.utils.api</span> <span class="kn">import</span> <span class="n">parse_state</span>

<span class="kn">from</span> <span class="nn">dowhy.causal_estimator</span> <span class="kn">import</span> <span class="n">estimate_effect</span>  <span class="c1"># Estimate effect function</span>

<span class="kn">from</span> <span class="nn">dowhy.causal_graph</span> <span class="kn">import</span> <span class="n">CausalGraph</span>

<span class="c1"># Other imports required</span>
<span class="kn">from</span> <span class="nn">dowhy.datasets</span> <span class="kn">import</span> <span class="n">linear_dataset</span>
<span class="kn">from</span> <span class="nn">dowhy</span> <span class="kn">import</span> <span class="n">CausalModel</span>  <span class="c1"># We still need this as we haven&#39;t created the functional API for effect estimation</span>
<span class="kn">import</span> <span class="nn">econml</span>

<span class="c1"># Config dict to set the logging level</span>
<span class="kn">import</span> <span class="nn">logging.config</span>

<span class="n">DEFAULT_LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;disable_existing_loggers&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;loggers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>


<span class="c1"># set random seed for deterministic dataset generation</span>
<span class="c1"># and avoid problems when running tests</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">DEFAULT_LOGGING</span><span class="p">)</span>
<span class="c1"># Disabling warnings output</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">DataConversionWarning</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">DataConversionWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Create-the-Datasets">
<h2>Create the Datasets<a class="headerlink" href="#Create-the-Datasets" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters for creating the Dataset</span>
<span class="n">TREATMENT_IS_BINARY</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">BETA</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">NUM_SAMPLES</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">NUM_CONFOUNDERS</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">NUM_INSTRUMENTS</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">NUM_EFFECT_MODIFIERS</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Creating a Linear Dataset with the given parameters</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">linear_dataset</span><span class="p">(</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">BETA</span><span class="p">,</span>
    <span class="n">num_common_causes</span><span class="o">=</span><span class="n">NUM_CONFOUNDERS</span><span class="p">,</span>
    <span class="n">num_instruments</span><span class="o">=</span><span class="n">NUM_INSTRUMENTS</span><span class="p">,</span>
    <span class="n">num_effect_modifiers</span><span class="o">=</span><span class="n">NUM_EFFECT_MODIFIERS</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="n">NUM_SAMPLES</span><span class="p">,</span>
    <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">treatment_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;treatment_name&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">treatment_name</span><span class="p">)</span>
<span class="n">outcome_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;outcome_name&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outcome_name</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">CausalGraph</span><span class="p">(</span>
    <span class="n">treatment_name</span><span class="o">=</span><span class="n">treatment_name</span><span class="p">,</span>
    <span class="n">outcome_name</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">graph</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gml_graph&quot;</span><span class="p">],</span>
    <span class="n">effect_modifier_names</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;effect_modifier_names&quot;</span><span class="p">],</span>
    <span class="n">common_cause_names</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;common_causes_names&quot;</span><span class="p">],</span>
    <span class="n">observed_node_names</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;v0&#39;]
y
</pre></div></div>
</div>
</section>
<section id="Identify-Effect---Functional-API-(Preview)">
<h2>Identify Effect - Functional API (Preview)<a class="headerlink" href="#Identify-Effect---Functional-API-(Preview)" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default identify_effect call example:</span>
<span class="n">identified_estimand</span> <span class="o">=</span> <span class="n">identify_effect</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">treatment_name</span><span class="p">,</span> <span class="n">outcome_name</span><span class="p">)</span>

<span class="c1"># auto_identify_effect example with extra parameters:</span>
<span class="n">identified_estimand_auto</span> <span class="o">=</span> <span class="n">identify_effect_auto</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="p">,</span>
    <span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">estimand_type</span><span class="o">=</span><span class="n">EstimandType</span><span class="o">.</span><span class="n">NONPARAMETRIC_ATE</span><span class="p">,</span>
    <span class="n">backdoor_adjustment</span><span class="o">=</span><span class="n">BackdoorAdjustment</span><span class="o">.</span><span class="n">BACKDOOR_EFFICIENT</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># id_identify_effect example:</span>
<span class="n">identified_estimand_id</span> <span class="o">=</span> <span class="n">identify_effect_id</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span> <span class="n">treatment_name</span><span class="p">,</span> <span class="n">outcome_name</span>
<span class="p">)</span>  <span class="c1"># Note that the return type for id_identify_effect is IDExpression and not IdentifiedEstimand</span>

<span class="nb">print</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W2,W1])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W2,W1,U) = P(y|v0,W0,W2,W1)

### Estimand : 2
Estimand name: iv
Estimand expression:
 ⎡                              -1⎤
 ⎢    d        ⎛    d          ⎞  ⎥
E⎢─────────(y)⋅⎜─────────([v₀])⎟  ⎥
 ⎣d[Z₁  Z₀]    ⎝d[Z₁  Z₀]      ⎠  ⎦
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!

</pre></div></div>
</div>
</section>
<section id="Estimate-Effect---Functional-API-(Preview)">
<h2>Estimate Effect - Functional API (Preview)<a class="headerlink" href="#Estimate-Effect---Functional-API-(Preview)" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Estimate Effect function</span>


<span class="n">propensity_score_estimator</span> <span class="o">=</span> <span class="n">PropensityScoreMatchingEstimator</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
    <span class="n">identified_estimand</span><span class="o">=</span><span class="n">identified_estimand</span><span class="p">,</span>
    <span class="n">treatment</span><span class="o">=</span><span class="n">treatment_name</span><span class="p">,</span>
    <span class="n">outcome</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">control_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">treatment_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">test_significance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">evaluate_effect_strength</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">target_units</span><span class="o">=</span><span class="s2">&quot;ate&quot;</span><span class="p">,</span>
    <span class="n">effect_modifiers</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">get_effect_modifiers</span><span class="p">(</span><span class="n">treatment_name</span><span class="p">,</span> <span class="n">outcome_name</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">estimate</span> <span class="o">=</span> <span class="n">estimate_effect</span><span class="p">(</span>
    <span class="n">treatment</span><span class="o">=</span><span class="n">treatment_name</span><span class="p">,</span>
    <span class="n">outcome</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">identified_estimand</span><span class="o">=</span><span class="n">identified_estimand</span><span class="p">,</span>
    <span class="n">identifier_name</span><span class="o">=</span><span class="s2">&quot;backdoor&quot;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="n">propensity_score_estimator</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W2,W1])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W2,W1,U) = P(y|v0,W0,W2,W1)

## Realized estimand
b: y~v0+W0+W2+W1
Target units: ate

## Estimate
Mean value: 11.326873255880667

</pre></div></div>
</div>
</section>
<section id="Refute-Estimate---Functional-API-(Preview)">
<h2>Refute Estimate - Functional API (Preview)<a class="headerlink" href="#Refute-Estimate---Functional-API-(Preview)" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># You can call the refute_estimate function for executing several refuters using default parameters</span>
<span class="c1"># Currently this function does not support sensitivity_* functions</span>
<span class="n">refutation_results</span> <span class="o">=</span> <span class="n">refute_estimate</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
    <span class="n">identified_estimand</span><span class="p">,</span>
    <span class="n">estimate</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="o">=</span><span class="n">treatment_name</span><span class="p">,</span>
    <span class="n">outcome_name</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">refuters</span><span class="o">=</span><span class="p">[</span><span class="n">refute_bootstrap</span><span class="p">,</span> <span class="n">refute_data_subset</span><span class="p">],</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">refutation_results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># Or you can execute refute methods directly</span>
<span class="c1"># You can change the refute_bootstrap - refute_data_subset for any of the other refuters and add the missing parameters</span>

<span class="n">bootstrap_refutation</span> <span class="o">=</span> <span class="n">refute_bootstrap</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">],</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bootstrap_refutation</span><span class="p">)</span>

<span class="n">data_subset_refutation</span> <span class="o">=</span> <span class="n">refute_data_subset</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">],</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_subset_refutation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Bootstrap Sample Dataset
Estimated effect:11.326873255880667
New effect:11.523210138690548
p value:0.84

Refute: Use a subset of data
Estimated effect:11.326873255880667
New effect:11.915307082038243
p value:0.46

Refute: Bootstrap Sample Dataset
Estimated effect:11.326873255880667
New effect:11.752292239886295
p value:0.72

Refute: Use a subset of data
Estimated effect:11.326873255880667
New effect:11.776657171410216
p value:0.5

</pre></div></div>
</div>
</section>
</section>
<section id="Backwards-Compatibility">
<h1>Backwards Compatibility<a class="headerlink" href="#Backwards-Compatibility" title="Permalink to this heading"></a></h1>
<p>This section shows replicating the same results using only the CausalModel API</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Causal Model</span>
<span class="n">causal_model</span> <span class="o">=</span> <span class="n">CausalModel</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">],</span> <span class="n">treatment</span><span class="o">=</span><span class="n">treatment_name</span><span class="p">,</span> <span class="n">outcome</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gml_graph&quot;</span><span class="p">])</span>
<br/></pre></div>
</div>
</div>
<section id="Identify-Effect">
<h2>Identify Effect<a class="headerlink" href="#Identify-Effect" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">identified_estimand_causal_model_api</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">causal_model</span><span class="o">.</span><span class="n">identify_effect</span><span class="p">()</span>
<span class="p">)</span>  <span class="c1"># graph, treatment and outcome comes from the causal_model object</span>

<span class="nb">print</span><span class="p">(</span><span class="n">identified_estimand_causal_model_api</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W2,W1])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W2,W1,U) = P(y|v0,W0,W2,W1)

### Estimand : 2
Estimand name: iv
Estimand expression:
 ⎡                              -1⎤
 ⎢    d        ⎛    d          ⎞  ⎥
E⎢─────────(y)⋅⎜─────────([v₀])⎟  ⎥
 ⎣d[Z₁  Z₀]    ⎝d[Z₁  Z₀]      ⎠  ⎦
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!

</pre></div></div>
</div>
</section>
<section id="Estimate-Effect">
<h2>Estimate Effect<a class="headerlink" href="#Estimate-Effect" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimate_causal_model_api</span> <span class="o">=</span> <span class="n">causal_model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
    <span class="n">identified_estimand_causal_model_api</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.propensity_score_matching&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">estimate_causal_model_api</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Identified estimand
Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(E[y|W0,W2,W1])
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W0,W2,W1,U) = P(y|v0,W0,W2,W1)

## Realized estimand
b: y~v0+W0+W2+W1
Target units: ate

## Estimate
Mean value: 11.326873255880667

</pre></div></div>
</div>
</section>
<section id="Refute-Estimate">
<h2>Refute Estimate<a class="headerlink" href="#Refute-Estimate" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrap_refutation_causal_model_api</span> <span class="o">=</span> <span class="n">causal_model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span><span class="n">identified_estimand_causal_model_api</span><span class="p">,</span> <span class="n">estimate_causal_model_api</span><span class="p">,</span> <span class="s2">&quot;bootstrap_refuter&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bootstrap_refutation_causal_model_api</span><span class="p">)</span>

<span class="n">data_subset_refutation_causal_model_api</span> <span class="o">=</span> <span class="n">causal_model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span>
    <span class="n">identified_estimand_causal_model_api</span><span class="p">,</span> <span class="n">estimate_causal_model_api</span><span class="p">,</span> <span class="s2">&quot;data_subset_refuter&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data_subset_refutation_causal_model_api</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Bootstrap Sample Dataset
Estimated effect:11.326873255880667
New effect:11.927231901822063
p value:0.46

Refute: Use a subset of data
Estimated effect:11.326873255880667
New effect:11.898436682251015
p value:0.5

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PyWhy contributors.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>