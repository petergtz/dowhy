<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B139P18WHM');
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dowhy.causal_estimator &mdash; DoWhy  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> DoWhy
          </a>
              <div class="version">
                v0.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introducing DoWhy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">DoWhy | An end-to-end library for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html#graphical-models-and-potential-outcomes-best-of-both-worlds">Graphical Models and Potential Outcomes: Best of both worlds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html#four-steps-of-causal-inference">Four steps of causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html#citing-this-package">Citing this package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html#roadmap">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html#contributing">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick-Start Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/tutorial-causalinference-machinelearning-using-dowhy-econml.html">Tutorial on Causal Inference and its Connections to Machine Learning (Using DoWhy+EconML)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Starter Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_simple_example.html">Getting started with DoWhy: A simple example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_confounder_example.html">Confounding Example: Finding causal effects from observed data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_estimation_methods.html">DoWhy: Different estimation methods for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy-simple-iv-example.html">Simple example on using Instrumental Variables method for estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/load_graph_example.html">Different ways to load an input graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_causal_api.html">Demo for the DoWhy causal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/do_sampler_demo.html">Do-sampler Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case Study Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/DoWhy-The%20Causal%20Story%20Behind%20Hotel%20Booking%20Cancellations.html">DoWhy-The Causal Story Behind Hotel Booking Cancellations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_example_effect_of_memberrewards_program.html">Estimating the effect of a Member Rewards program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_ihdp_data_example.html">DoWhy example on ihdp (Infant Health and Development Program) dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_lalonde_example.html">DoWhy example on the Lalonde dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_refutation_testing.html">Applying refutation tests to the Lalonde and IHDP datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/lalonde_pandas_api.html">Lalonde Pandas API Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy-conditional-treatment-effects.html">Conditional Average Treatment Effects (CATE) with DoWhy and EconML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_mediation_analysis.html">Mediation analysis with DoWhy: Direct and Indirect Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_demo_dummy_outcome_refuter.html">A Simple Example on Creating a Custom Refutation Using User-Defined Outcome Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_multiple_treatments.html">Estimating effect of multiple treatments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_notebooks/dowhy_refuter_notebook.html">Iterating over multiple refutation tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code_repo.html">Code repository &amp; Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dowhy.html">dowhy package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DoWhy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>dowhy.causal_estimator</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dowhy.causal_estimator</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span>

<span class="kn">import</span> <span class="nn">dowhy.interpreters</span> <span class="k">as</span> <span class="nn">interpreters</span>
<span class="kn">from</span> <span class="nn">dowhy.utils.api</span> <span class="kn">import</span> <span class="n">parse_state</span>

<div class="viewcode-block" id="CausalEstimator"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator">[docs]</a><span class="k">class</span> <span class="nc">CausalEstimator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for an estimator of causal effect.</span>

<span class="sd">    Subclasses implement different estimation methods. All estimation methods are in the package &quot;dowhy.causal_estimators&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The default number of simulations for statistical testing</span>
    <span class="n">DEFAULT_NUMBER_OF_SIMULATIONS_STAT_TEST</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="c1"># The default number of simulations to obtain confidence intervals</span>
    <span class="n">DEFAULT_NUMBER_OF_SIMULATIONS_CI</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="c1"># The portion of the total size that should be taken each time to find the confidence intervals</span>
    <span class="c1"># 1 is the recommended value</span>
    <span class="c1"># https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading24.pdf</span>
    <span class="c1"># https://projecteuclid.org/download/pdf_1/euclid.ss/1032280214</span>
    <span class="n">DEFAULT_SAMPLE_SIZE_FRACTION</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># The default Confidence Level</span>
    <span class="n">DEFAULT_CONFIDENCE_LEVEL</span> <span class="o">=</span> <span class="mf">0.95</span>
    <span class="c1"># Number of quantiles to discretize continuous columns, for applying groupby</span>
    <span class="n">NUM_QUANTILES_TO_DISCRETIZE_CONT_COLS</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="c1"># Prefix to add to temporary categorical variables created after discretization</span>
    <span class="n">TEMP_CAT_COLUMN_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;__categorical__&quot;</span>

    <span class="n">DEFAULT_NOTIMPLEMENTEDERROR_MSG</span> <span class="o">=</span> <span class="s2">&quot;not yet implemented for </span><span class="si">{0}</span><span class="s2">. If you would this to be implemented in the next version, please raise an issue at https://github.com/microsoft/dowhy/issues&quot;</span>

    <span class="n">BootstrapEstimates</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;BootstrapEstimates&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;estimates&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">])</span>

    <span class="n">DEFAULT_INTERPRET_METHOD</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;textual_effect_interpreter&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span>
                 <span class="n">control_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">treatment_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">test_significance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">evaluate_effect_strength</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">target_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">effect_modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes an estimator with data and names of relevant variables.</span>

<span class="sd">        This method is called from the constructors of its child classes.</span>

<span class="sd">        :param data: data frame containing the data</span>
<span class="sd">        :param identified_estimand: probability expression</span>
<span class="sd">            representing the target identified estimand to estimate.</span>
<span class="sd">        :param treatment: name of the treatment variable</span>
<span class="sd">        :param outcome: name of the outcome variable</span>
<span class="sd">        :param control_value: Value of the treatment in the control group, for effect estimation.  If treatment is multi-variate, this can be a list.</span>
<span class="sd">        :param treatment_value: Value of the treatment in the treated group, for effect estimation. If treatment is multi-variate, this can be a list.</span>
<span class="sd">        :param test_significance: Binary flag or a string indicating whether to test significance and by which method. All estimators support test_significance=&quot;bootstrap&quot; that estimates a p-value for the obtained estimate using the bootstrap method. Individual estimators can override this to support custom testing methods. The bootstrap method supports an optional parameter, num_null_simulations that can be specified through the params dictionary. If False, no testing is done. If True, significance of the estimate is tested using the custom method if available, otherwise by bootstrap.</span>
<span class="sd">        :param evaluate_effect_strength: (Experimental) whether to evaluate the strength of effect</span>
<span class="sd">        :param confidence_intervals: Binary flag or a string indicating whether the confidence intervals should be computed and which method should be used. All methods support estimation of confidence intervals using the bootstrap method by using the parameter confidence_intervals=&quot;bootstrap&quot;. The bootstrap method takes in two arguments (num_simulations and sample_size_fraction) that can be optionally specified in the params dictionary. Estimators may also override this to implement their own confidence interval method. If this parameter is False, no confidence intervals are computed. If True, confidence intervals are computed by the estimator&#39;s specific method if available, otherwise through bootstrap.</span>
<span class="sd">        :param target_units: The units for which the treatment effect should be estimated. This can be a string for common specifications of target units (namely, &quot;ate&quot;, &quot;att&quot; and &quot;atc&quot;). It can also be a lambda function that can be used as an index for the data (pandas DataFrame). Alternatively, it can be a new DataFrame that contains values of the effect_modifiers and effect will be estimated only for this new data.</span>
<span class="sd">        :param effect_modifiers: Variables on which to compute separate effects, or return a heterogeneous effect function. Not all methods support this currently.</span>
<span class="sd">        :param params: (optional) Additional method parameters</span>
<span class="sd">            num_null_simulations: The number of simulations for testing the statistical significance of the estimator</span>
<span class="sd">            num_simulations: The number of simulations for finding the confidence interval (and/or standard error) for a estimate</span>
<span class="sd">            sample_size_fraction: The size of the sample for the bootstrap estimator</span>
<span class="sd">            confidence_level: The confidence level of the confidence interval estimate</span>
<span class="sd">            num_quantiles_to_discretize_cont_cols: The number of quantiles into which a numeric effect modifier is split, to enable estimation of conditional treatment effect over it.</span>
<span class="sd">        :returns: an instance of the estimator class.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span> <span class="o">=</span> <span class="n">identified_estimand</span>
        <span class="c1"># Currently estimation methods only support univariate treatment and outcome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span> <span class="o">=</span> <span class="n">treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outcome_name</span> <span class="o">=</span> <span class="n">outcome</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># assuming one-dimensional outcome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control_value</span> <span class="o">=</span> <span class="n">control_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span> <span class="o">=</span> <span class="n">treatment_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_significance_test</span> <span class="o">=</span> <span class="n">test_significance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_effect_strength_eval</span> <span class="o">=</span> <span class="n">evaluate_effect_strength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span> <span class="o">=</span> <span class="n">target_units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span> <span class="o">=</span> <span class="n">effect_modifiers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span> <span class="o">=</span> <span class="n">confidence_intervals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># for confidence intervals and std error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_null_estimates</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># for significance test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_params</span> <span class="o">=</span> <span class="n">params</span>

        <span class="c1"># Setting the default interpret method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpret_method</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_INTERPRET_METHOD</span>
        <span class="c1"># Unpacking the keyword arguments</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># Checking if some parameters were set, otherwise setting to default values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;num_null_simulations&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_null_simulations</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_SIMULATIONS_STAT_TEST</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;num_simulations&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_simulations</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_SIMULATIONS_CI</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sample_size_fraction&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample_size_fraction</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_SAMPLE_SIZE_FRACTION</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;confidence_level&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confidence_level</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_CONFIDENCE_LEVEL</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;num_quantiles_to_discretize_cont_cols&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles_to_discretize_cont_cols</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">NUM_QUANTILES_TO_DISCRETIZE_CONT_COLS</span>
        <span class="c1"># Estimate conditional estimates by default</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;need_conditional_estimates&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">need_conditional_estimates</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">)</span>
        <span class="c1"># Setting more values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treatment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">]</span>

        <span class="c1"># Now saving the effect modifiers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Effect modifiers: &quot;</span> <span class="o">+</span>
                          <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">))</span>

<div class="viewcode-block" id="CausalEstimator.get_estimator_object"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.get_estimator_object">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_estimator_object</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">estimate</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a new estimator of the same type as the one passed in the estimate argument.</span>

<span class="sd">        Creates a new object with new_data and the identified_estimand</span>

<span class="sd">        :param new_data: np.ndarray, pd.Series, pd.DataFrame</span>
<span class="sd">        The newly assigned data on which the estimator should run</span>
<span class="sd">        :param identified_estimand: IdentifiedEstimand</span>
<span class="sd">        An instance of the identified estimand class that provides the information with</span>
<span class="sd">        respect to which causal pathways are employed when the treatment effects the outcome</span>
<span class="sd">        :param estimate: CausalEstimate</span>
<span class="sd">        It is an already existing estimate whose properties we wish to replicate</span>

<span class="sd">        :returns: An instance of the same estimator class that had generated the given estimate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">estimator_class</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;estimator_class&#39;</span><span class="p">]</span>
        <span class="n">new_estimator</span> <span class="o">=</span> <span class="n">estimator_class</span><span class="p">(</span>
                <span class="n">new_data</span><span class="p">,</span>
                <span class="n">identified_estimand</span><span class="p">,</span>
                <span class="n">identified_estimand</span><span class="o">.</span><span class="n">treatment_variable</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">outcome_variable</span><span class="p">,</span> <span class="c1">#names of treatment and outcome</span>
                <span class="n">test_significance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">evaluate_effect_strength</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;confidence_intervals&quot;</span><span class="p">],</span>
                <span class="n">target_units</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;target_units&quot;</span><span class="p">],</span>
                <span class="n">effect_modifiers</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;effect_modifiers&quot;</span><span class="p">],</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_estimator</span></div>


    <span class="k">def</span> <span class="nf">_estimate_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This method is to be overriden by the child classes, so that they can run the estimation technique of their choice</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s2">&quot;Main estimation method is &quot;</span> <span class="o">+</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NOTIMPLEMENTEDERROR_MSG</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>

<div class="viewcode-block" id="CausalEstimator.estimate_effect"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.estimate_effect">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base estimation method that calls the estimate_effect method of its calling subclass.</span>

<span class="sd">        Can optionally also test significance and estimate effect strength for any returned estimate.</span>

<span class="sd">        :param self: object instance of class Estimator</span>
<span class="sd">        :returns: A CausalEstimate instance that contains point estimates of average and conditional effects. Based on the parameters provided, it optionally includes confidence intervals, standard errors,statistical significance and other statistical parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_effect</span><span class="p">()</span>
        <span class="n">est</span><span class="o">.</span><span class="n">add_estimator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_significance_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_significance</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_significance_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimate_confidence_intervals</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span><span class="p">,</span>
                    <span class="n">confidence_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence_level</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_strength_eval</span><span class="p">:</span>
            <span class="n">effect_strength_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_effect_strength</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
            <span class="n">est</span><span class="o">.</span><span class="n">add_effect_strength</span><span class="p">(</span><span class="n">effect_strength_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">est</span></div>

<div class="viewcode-block" id="CausalEstimator.estimate_effect_naive"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.estimate_effect_naive">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_effect_naive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#TODO Only works for binary treatment</span>
        <span class="n">df_withtreatment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">df_notreatment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">]</span><span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_withtreatment</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_notreatment</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">CausalEstimate</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_estimate_effect_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function used in conditional effect estimation. This function is to be overridden by each child estimator.</span>

<span class="sd">        The overridden function should take in a dataframe as input and return the estimate for that data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s2">&quot;Conditional treatment effects are &quot;</span> <span class="o">+</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NOTIMPLEMENTEDERROR_MSG</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_estimate_conditional_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimate_effect_fn</span><span class="p">,</span>
            <span class="n">effect_modifier_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">num_quantiles</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate conditional treatment effects. Common method for all estimators that utilizes a specific estimate_effect_fn implemented by each child estimator.</span>

<span class="sd">        If a numeric effect modifier is provided, it is discretized into quantile bins. If you would like a custom discretization, you can do so yourself: create a new column containing the discretized effect modifier and then include that column&#39;s name in the effect_modifier_names argument.</span>

<span class="sd">        :param estimate_effect_fn: Function that has a single parameter (a data frame) and returns the treatment effect estimate on that data.</span>
<span class="sd">        :param effect_modifier_names: Names of effect modifier variables over which the conditional effects will be estimated. If not provided, defaults to the effect modifiers specified during creation of the CausalEstimator object.</span>
<span class="sd">        :param num_quantiles: The number of quantiles into which a numeric effect modifier variable is discretized. Does not affect any categorical effect modifiers.</span>

<span class="sd">        :returns: A (multi-index) dataframe that provides separate effects for each value of the (discretized) effect modifiers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Defaulting to class default values if parameters are not provided</span>
        <span class="k">if</span> <span class="n">effect_modifier_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">effect_modifier_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span>
        <span class="k">if</span> <span class="n">num_quantiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_quantiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_quantiles_to_discretize_cont_cols</span>
        <span class="c1"># Checking that there is at least one effect modifier</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">effect_modifier_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one effect modifier should be specified to compute conditional effects.&quot;</span><span class="p">)</span>
        <span class="c1"># Making sure that effect_modifier_names is a list</span>
        <span class="n">effect_modifier_names</span> <span class="o">=</span> <span class="n">parse_state</span><span class="p">(</span><span class="n">effect_modifier_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">em</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span> <span class="k">for</span> <span class="n">em</span> <span class="ow">in</span> <span class="n">effect_modifier_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;At least one of the provided effect modifiers was not included while fitting the estimator. You may get incorrect results. To resolve, fit the estimator again by providing the updated effect modifiers in estimate_effect().&quot;</span><span class="p">)</span>
        <span class="c1"># Making a copy since we are going to be changing effect modifier names</span>
        <span class="n">effect_modifier_names</span> <span class="o">=</span> <span class="n">effect_modifier_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">TEMP_CAT_COLUMN_PREFIX</span>
        <span class="c1"># For every numeric effect modifier, adding a temp categorical column</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">effect_modifier_names</span><span class="p">)):</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">effect_modifier_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">em</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">em</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">em</span><span class="p">],</span>
                        <span class="n">num_quantiles</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
                <span class="n">effect_modifier_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="c1"># Grouping by effect modifiers and computing effect separately</span>
        <span class="n">by_effect_mods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">effect_modifier_names</span><span class="p">)</span>
        <span class="n">cond_est_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_do</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_control_value</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">conditional_estimates</span> <span class="o">=</span> <span class="n">by_effect_mods</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">estimate_effect_fn</span><span class="p">)</span>
        <span class="c1"># Deleting the temporary categorical columns</span>
        <span class="k">for</span> <span class="n">em</span> <span class="ow">in</span> <span class="n">effect_modifier_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">em</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conditional_estimates</span>


    <span class="k">def</span> <span class="nf">_do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s2">&quot;Do-operator is &quot;</span> <span class="o">+</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NOTIMPLEMENTEDERROR_MSG</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>

<div class="viewcode-block" id="CausalEstimator.do"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.do">[docs]</a>    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method that implements the do-operator.</span>

<span class="sd">        Given a value x for the treatment, returns the expected value of the outcome when the treatment is intervened to a value x.</span>

<span class="sd">        :param x: Value of the treatment</span>
<span class="sd">        :param data_df: Data on which the do-operator is to be applied.</span>

<span class="sd">        :returns: Value of the outcome when treatment is intervened/set to x.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">est</span></div>

<div class="viewcode-block" id="CausalEstimator.construct_symbolic_estimator"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.construct_symbolic_estimator">[docs]</a>    <span class="k">def</span> <span class="nf">construct_symbolic_estimator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimand</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s2">&quot;Symbolic estimator string is &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_generate_bootstrap_estimates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_bootstrap_simulations</span><span class="p">,</span>
            <span class="n">sample_size_fraction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Helper function to generate causal estimates over bootstrapped samples.</span>

<span class="sd">        :param num_bootstrap_simulations: Number of simulations for the bootstrap method.</span>
<span class="sd">        :param sample_size_fraction: Fraction of the dataset to be resampled.</span>
<span class="sd">        :returns: A collections.namedtuple containing a list of bootstrapped estimates and a dictionary containing parameters used for the bootstrap.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The array that stores the results of all estimations</span>
        <span class="n">simulation_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_bootstrap_simulations</span><span class="p">)</span>

        <span class="c1"># Find the sample size the proportion with the population size</span>
        <span class="n">sample_size</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">sample_size_fraction</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">sample_size</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;WARN: The sample size is greater than the data being sampled&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;INFO: The sample size: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;INFO: The number of simulations: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_bootstrap_simulations</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># Perform the set number of simulations</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bootstrap_simulations</span><span class="p">):</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span><span class="n">n_samples</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>

            <span class="n">new_estimator</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span>
                <span class="n">new_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">treatment_variable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">outcome_variable</span><span class="p">,</span> <span class="c1">#names of treatment and outcome</span>
                <span class="n">test_significance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">evaluate_effect_strength</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">target_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span><span class="p">,</span>
                <span class="n">effect_modifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">,</span>
                <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_params</span>
                <span class="p">)</span>
            <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">()</span>
            <span class="n">simulation_results</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">BootstrapEstimates</span><span class="p">(</span><span class="n">simulation_results</span><span class="p">,</span>
                <span class="p">{</span><span class="s1">&#39;num_simulations&#39;</span><span class="p">:</span> <span class="n">num_bootstrap_simulations</span><span class="p">,</span>
                <span class="s1">&#39;sample_size_fraction&#39;</span><span class="p">:</span> <span class="n">sample_size_fraction</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">estimates</span>


    <span class="k">def</span> <span class="nf">_estimate_confidence_intervals_with_bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">confidence_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">num_simulations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_size_fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Method to compute confidence interval using bootstrapped sampling.</span>

<span class="sd">            :param confidence_level: The level for which to compute CI (e.g., 95% confidence level translates to confidence_level=0.95)</span>
<span class="sd">            :param num_simulations: The number of simulations to be performed to get the bootstrap confidence intervals.</span>
<span class="sd">            :param sample_size_fraction: The fraction of the dataset to be resampled.</span>
<span class="sd">            :returns: confidence interval at the specified level.</span>

<span class="sd">            For more details on bootstrap or resampling statistics, refer to the following links:</span>
<span class="sd">            https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading24.pdf</span>
<span class="sd">            https://projecteuclid.org/download/pdf_1/euclid.ss/1032280214</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Using class default parameters if not specified</span>
        <span class="k">if</span> <span class="n">num_simulations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_simulations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_simulations</span>
        <span class="k">if</span> <span class="n">sample_size_fraction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sample_size_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_size_fraction</span>

        <span class="c1"># Checking if bootstrap_estimates are already computed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_bootstrap_estimates</span><span class="p">(</span>
                    <span class="n">num_simulations</span><span class="p">,</span> <span class="n">sample_size_fraction</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">is_bootstrap_parameter_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="nb">locals</span><span class="p">()):</span>
            <span class="c1"># Checked if any parameter is changed from the previous std error estimate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_bootstrap_estimates</span><span class="p">(</span>
                    <span class="n">num_simulations</span><span class="p">,</span> <span class="n">sample_size_fraction</span><span class="p">)</span>
        <span class="c1"># Now use the data obtained from the simulations to get the value of the confidence estimates</span>
        <span class="c1"># Sort the simulations</span>
        <span class="n">bootstrap_estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span><span class="o">.</span><span class="n">estimates</span><span class="p">)</span>
        <span class="c1"># Now we take the (1- p)th and the (p)th values, where p is the chosen confidence level</span>
        <span class="n">lower_bound_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span> <span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bootstrap_estimates</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">upper_bound_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">confidence_level</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bootstrap_estimates</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># get the values</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">bootstrap_estimates</span><span class="p">[</span><span class="n">lower_bound_index</span><span class="p">]</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">bootstrap_estimates</span><span class="p">[</span><span class="n">upper_bound_index</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_estimate_confidence_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            This method is to be overriden by the child classes, so that they</span>
<span class="sd">            can run a confidence interval estimation method suited to the specific</span>
<span class="sd">            causal estimator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s2">&quot;This method for estimating confidence intervals is &quot;</span> <span class="o">+</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NOTIMPLEMENTEDERROR_MSG</span> <span class="o">+</span> <span class="s2">&quot; Meanwhile, you can try the bootstrap method (method=&#39;bootstrap&#39;) to estimate confidence intervals.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>

<div class="viewcode-block" id="CausalEstimator.estimate_confidence_intervals"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.estimate_confidence_intervals">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_confidence_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confidence_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Find the confidence intervals corresponding to any estimator</span>
<span class="sd">            By default, this is done with the help of bootstrapped confidence intervals</span>
<span class="sd">            but can be overridden if the specific estimator implements other methods of estimating confidence intervals.</span>

<span class="sd">            If the method provided is not bootstrap, this function calls the implementation of the specific estimator.</span>

<span class="sd">            :param method: Method for estimating confidence intervals.</span>
<span class="sd">            :param confidence_level: The confidence level of the confidence intervals of the estimate.</span>
<span class="sd">            :param kwargs: Other optional args to be passed to the CI method.</span>
<span class="sd">            :returns: The obtained confidence interval.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span> <span class="c1"># this is either True or methodname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">confidence_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">confidence_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confidence_level</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># user has not provided any method</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_confidence_intervals</span><span class="p">(</span>
                        <span class="n">confidence_level</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_confidence_intervals_with_bootstrap</span><span class="p">(</span>
                         <span class="n">confidence_level</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span>
                <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_confidence_intervals_with_bootstrap</span><span class="p">(</span>
                         <span class="n">confidence_level</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_confidence_intervals</span><span class="p">(</span>
                        <span class="n">confidence_level</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">confidence_intervals</span></div>

    <span class="k">def</span> <span class="nf">_estimate_std_error_with_bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_simulations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">sample_size_fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compute standard error using the bootstrap method. Standard error</span>
<span class="sd">        and confidence intervals use the same parameter num_simulations for</span>
<span class="sd">        the number of bootstrap simulations.</span>

<span class="sd">        :param num_simulations: Number of bootstrapped samples.</span>
<span class="sd">        :param sample_size_fraction: Fraction of data to be resampled.</span>
<span class="sd">        :returns: Standard error of the obtained estimate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use existing params, if new user defined params are not present</span>
        <span class="k">if</span> <span class="n">num_simulations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_simulations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_simulations</span>
        <span class="k">if</span> <span class="n">sample_size_fraction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sample_size_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_size_fraction</span>
        <span class="c1"># Checking if bootstrap_estimates are already computed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_bootstrap_estimates</span><span class="p">(</span>
                    <span class="n">num_simulations</span><span class="p">,</span> <span class="n">sample_size_fraction</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">is_bootstrap_parameter_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="nb">locals</span><span class="p">()):</span>
            <span class="c1"># Check if any parameter is changed from the previous std error estimate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_bootstrap_estimates</span><span class="p">(</span>
                    <span class="n">num_simulations</span><span class="p">,</span> <span class="n">sample_size_fraction</span><span class="p">)</span>

        <span class="n">std_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_estimates</span><span class="o">.</span><span class="n">estimates</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">std_error</span>

    <span class="k">def</span> <span class="nf">_estimate_std_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            This method is to be overriden by the child classes, so that they</span>
<span class="sd">            can run a standard error estimation method suited to the specific</span>
<span class="sd">            causal estimator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s2">&quot;This method for estimating standard errors is &quot;</span> <span class="o">+</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NOTIMPLEMENTEDERROR_MSG</span> <span class="o">+</span> <span class="s2">&quot; Meanwhile, you can try the bootstrap method (method=&#39;bootstrap&#39;) to estimate standard errors.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>

<div class="viewcode-block" id="CausalEstimator.estimate_std_error"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.estimate_std_error">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_std_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compute standard error of an obtained causal estimate.</span>

<span class="sd">        :param method: Method for computing the standard error.</span>
<span class="sd">        :param kwargs: Other optional parameters to be passed to the estimating method.</span>
<span class="sd">        :returns: Standard error of the causal estimate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="n">std_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># user has not provided any method</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">std_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_std_error</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                <span class="n">std_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_std_error_with_bootstrap</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span>
                <span class="n">std_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_std_error_with_bootstrap</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">std_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_std_error</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">std_error</span></div>

    <span class="k">def</span> <span class="nf">_test_significance_with_bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimate_value</span><span class="p">,</span> <span class="n">num_null_simulations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test statistical significance of an estimate using the bootstrap method.</span>

<span class="sd">        :param estimate_value: Obtained estimate&#39;s value</span>
<span class="sd">        :param num_null_simulations: Number of simulations for the null hypothesis</span>
<span class="sd">        :returns: p-value of the statistical significance test.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use existing params, if new user defined params are not present</span>
        <span class="k">if</span> <span class="n">num_null_simulations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_null_simulations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_null_simulations</span>
        <span class="n">do_retest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_null_estimates</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">is_bootstrap_parameter_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_null_estimates</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="nb">locals</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">do_retest</span><span class="p">:</span>
            <span class="n">null_estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_null_simulations</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_null_simulations</span><span class="p">):</span>
                <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_outcome</span><span class="p">)</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">dummy_outcome</span><span class="o">=</span><span class="n">new_outcome</span><span class="p">)</span>
                <span class="c1">#self._outcome = self._data[&quot;dummy_outcome&quot;]</span>
                <span class="n">new_estimator</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span>
                    <span class="n">new_data</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">treatment_variable</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot;dummy_outcome&quot;</span><span class="p">,),</span>
                    <span class="n">test_significance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">evaluate_effect_strength</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">target_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span><span class="p">,</span>
                    <span class="n">effect_modifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">,</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_params</span>
                    <span class="p">)</span>
                <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">()</span>
                <span class="n">null_estimates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_null_estimates</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">BootstrapEstimates</span><span class="p">(</span>
                    <span class="n">null_estimates</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;num_null_simulations&#39;</span><span class="p">:</span> <span class="n">num_null_simulations</span><span class="p">,</span> <span class="s1">&#39;sample_size_fraction&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

        <span class="c1"># Processing the null hypothesis estimates</span>
        <span class="n">sorted_null_estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_null_estimates</span><span class="o">.</span><span class="n">estimates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Null estimates: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sorted_null_estimates</span><span class="p">))</span>
        <span class="n">median_estimate</span> <span class="o">=</span> <span class="n">sorted_null_estimates</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">num_null_simulations</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="c1"># Doing a two-sided test</span>
        <span class="k">if</span> <span class="n">estimate_value</span> <span class="o">&gt;</span> <span class="n">median_estimate</span><span class="p">:</span>
            <span class="c1"># Being conservative with the p-value reported</span>
            <span class="n">estimate_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">sorted_null_estimates</span><span class="p">,</span> <span class="n">estimate_value</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">p_value</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">estimate_index</span> <span class="o">/</span> <span class="n">num_null_simulations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">estimate_value</span> <span class="o">&lt;=</span> <span class="n">median_estimate</span><span class="p">:</span>
            <span class="c1"># Being conservative with the p-value reported</span>
            <span class="n">estimate_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">sorted_null_estimates</span><span class="p">,</span> <span class="n">estimate_value</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
            <span class="n">p_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">estimate_index</span> <span class="o">/</span> <span class="n">num_null_simulations</span><span class="p">)</span>
        <span class="c1"># If the estimate_index is 0, it depends on the number of simulations</span>
        <span class="k">if</span> <span class="n">p_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p_value</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_null_estimates</span><span class="p">))</span> <span class="c1"># a tuple determining the range.</span>
        <span class="k">elif</span> <span class="n">p_value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p_value</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_null_estimates</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">signif_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="n">p_value</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">signif_dict</span>

    <span class="k">def</span> <span class="nf">_test_significance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimate_value</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            This method is to be overriden by the child classes, so that they</span>
<span class="sd">            can run a significance test suited to the specific</span>
<span class="sd">            causal estimator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">((</span><span class="s2">&quot;This method for testing statistical significance is &quot;</span> <span class="o">+</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NOTIMPLEMENTEDERROR_MSG</span> <span class="o">+</span> <span class="s2">&quot; Meanwhile, you can try the bootstrap method (method=&#39;bootstrap&#39;) to test statistical significance.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>

<div class="viewcode-block" id="CausalEstimator.test_significance"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.test_significance">[docs]</a>    <span class="k">def</span> <span class="nf">test_significance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimate_value</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test statistical significance of obtained estimate.</span>

<span class="sd">        By default, uses resampling to create a non-parametric significance test.</span>
<span class="sd">        A general procedure. Individual child estimators can implement different methods.</span>
<span class="sd">        If the method name is different from &quot;bootstrap&quot;, this function calls the</span>
<span class="sd">        implementation of the child estimator.</span>

<span class="sd">        :param self: object instance of class Estimator</span>
<span class="sd">        :param estimate_value: obtained estimate&#39;s value</span>
<span class="sd">        :param method: Method for checking statistical significance</span>

<span class="sd">        :returns: p-value from the significance test</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_significance_test</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_significance_test</span> <span class="c1"># this is either True or methodname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="n">signif_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># user has not provided any method</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">signif_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_significance</span><span class="p">(</span><span class="n">estimate_value</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                <span class="n">signif_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_significance_with_bootstrap</span><span class="p">(</span><span class="n">estimate_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span>
                <span class="n">signif_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_significance_with_bootstrap</span><span class="p">(</span><span class="n">estimate_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">signif_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_significance</span><span class="p">(</span><span class="n">estimate_value</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">signif_dict</span></div>

<div class="viewcode-block" id="CausalEstimator.evaluate_effect_strength"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.evaluate_effect_strength">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_effect_strength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimate</span><span class="p">):</span>
        <span class="n">fraction_effect_explained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_effect_strength</span><span class="p">(</span><span class="n">estimate</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fraction-effect&quot;</span><span class="p">)</span>
        <span class="c1"># Need to test r-squared before supporting</span>
        <span class="c1">#effect_r_squared = self._evaluate_effect_strength(estimate, method=&quot;r-squared&quot;)</span>
        <span class="n">strength_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;fraction-effect&#39;</span><span class="p">:</span> <span class="n">fraction_effect_explained</span>
         <span class="c1">#       &#39;r-squared&#39;: effect_r_squared</span>
                <span class="p">}</span>
        <span class="k">return</span> <span class="n">strength_dict</span></div>

    <span class="k">def</span> <span class="nf">_evaluate_effect_strength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimate</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fraction-effect&quot;</span><span class="p">):</span>
        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fraction-effect&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This method is not supported for evaluating effect strength&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fraction-effect&quot;</span><span class="p">:</span>
            <span class="n">naive_obs_estimate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_effect_naive</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">naive_obs_estimate</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">fraction_effect_explained</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">naive_obs_estimate</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="n">fraction_effect_explained</span>
        <span class="c1">#elif method == &quot;r-squared&quot;:</span>
        <span class="c1">#    outcome_mean = np.mean(self._outcome)</span>
        <span class="c1">#    total_variance = np.sum(np.square(self._outcome - outcome_mean))</span>
            <span class="c1"># Assuming a linear model with one variable: the treatment</span>
            <span class="c1"># Currently only works for continuous y</span>
        <span class="c1">#    causal_model = outcome_mean + estimate.value*self._treatment</span>
        <span class="c1">#    squared_residual = np.sum(np.square(self._outcome - causal_model))</span>
        <span class="c1">#    r_squared = 1 - (squared_residual/total_variance)</span>
        <span class="c1">#    return r_squared</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="CausalEstimator.is_bootstrap_parameter_changed"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.is_bootstrap_parameter_changed">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_bootstrap_parameter_changed</span><span class="p">(</span><span class="n">bootstrap_estimates_params</span><span class="p">,</span> <span class="n">given_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check whether parameters of the bootstrap have changed.</span>

<span class="sd">        This is an efficiency method that checks if fresh resampling of the bootstrap samples is required.</span>
<span class="sd">        Returns True if parameters have changed and resampling should be done again.</span>

<span class="sd">        :param bootstrap_estimates_params: A dictionary of parameters for the current bootstrap samples</span>
<span class="sd">        :param given_params: A dictionary of parameters passed by the user</span>
<span class="sd">        :returns: A binary flag denoting whether the parameters are different.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_any_parameter_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">prm</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bootstrap_estimates_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">given_val</span> <span class="o">=</span> <span class="n">given_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prm</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">given_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">given_val</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">is_any_parameter_changed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">is_any_parameter_changed</span></div>

<div class="viewcode-block" id="CausalEstimator.target_units_tostr"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.target_units_tostr">[docs]</a>    <span class="k">def</span> <span class="nf">target_units_tostr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Data subset defined by a function&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Data subset provided as a data frame&quot;</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="CausalEstimator.signif_results_tostr"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimator.signif_results_tostr">[docs]</a>    <span class="k">def</span> <span class="nf">signif_results_tostr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signif_results</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">pval</span> <span class="o">=</span> <span class="n">signif_results</span><span class="p">[</span><span class="s2">&quot;p_value&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div></div>

<div class="viewcode-block" id="CausalEstimate"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate">[docs]</a><span class="k">class</span> <span class="nc">CausalEstimate</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for the estimate object that every causal estimator returns</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimate</span><span class="p">,</span> <span class="n">target_estimand</span><span class="p">,</span> <span class="n">realized_estimand_expr</span><span class="p">,</span>
            <span class="n">conditional_estimates</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">estimate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_estimand</span> <span class="o">=</span> <span class="n">target_estimand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">realized_estimand_expr</span> <span class="o">=</span> <span class="n">realized_estimand_expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditional_estimates</span> <span class="o">=</span> <span class="n">conditional_estimates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">effect_strength</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CausalEstimate.add_estimator"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.add_estimator">[docs]</a>    <span class="k">def</span> <span class="nf">add_estimator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator_instance</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator_instance</span></div>

<div class="viewcode-block" id="CausalEstimate.add_effect_strength"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.add_effect_strength">[docs]</a>    <span class="k">def</span> <span class="nf">add_effect_strength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strength_dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">effect_strength</span> <span class="o">=</span> <span class="n">strength_dict</span></div>

<div class="viewcode-block" id="CausalEstimate.add_params"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.add_params">[docs]</a>    <span class="k">def</span> <span class="nf">add_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CausalEstimate.get_confidence_intervals"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.get_confidence_intervals">[docs]</a>    <span class="k">def</span> <span class="nf">get_confidence_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confidence_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get confidence intervals of the obtained estimate.</span>

<span class="sd">        By default, this is done with the help of bootstrapped confidence intervals</span>
<span class="sd">        but can be overridden if the specific estimator implements other methods of estimating confidence intervals.</span>

<span class="sd">        If the method provided is not bootstrap, this function calls the implementation of the specific estimator.</span>

<span class="sd">        :param method: Method for estimating confidence intervals.</span>
<span class="sd">        :param confidence_level: The confidence level of the confidence intervals of the estimate.</span>
<span class="sd">        :param kwargs: Other optional args to be passed to the CI method.</span>
<span class="sd">        :returns: The obtained confidence interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">confidence_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">estimate_confidence_intervals</span><span class="p">(</span>
                <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">confidence_intervals</span></div>

<div class="viewcode-block" id="CausalEstimate.get_standard_error"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.get_standard_error">[docs]</a>    <span class="k">def</span> <span class="nf">get_standard_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get standard error of the obtained estimate.</span>

<span class="sd">        By default, this is done with the help of bootstrapped standard errors</span>
<span class="sd">        but can be overridden if the specific estimator implements other methods of estimating standard error.</span>

<span class="sd">        If the method provided is not bootstrap, this function calls the implementation of the specific estimator.</span>

<span class="sd">        :param method: Method for computing the standard error.</span>
<span class="sd">        :param kwargs: Other optional parameters to be passed to the estimating method.</span>
<span class="sd">        :returns: Standard error of the causal estimate.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">std_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">estimate_std_error</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">std_error</span></div>

<div class="viewcode-block" id="CausalEstimate.test_stat_significance"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.test_stat_significance">[docs]</a>    <span class="k">def</span> <span class="nf">test_stat_significance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test statistical significance of the estimate obtained.</span>

<span class="sd">        By default, uses resampling to create a non-parametric significance test.</span>
<span class="sd">        Individual child estimators can implement different methods.</span>
<span class="sd">        If the method name is different from &quot;bootstrap&quot;, this function calls the</span>
<span class="sd">        implementation of the child estimator.</span>

<span class="sd">        :param method: Method for checking statistical significance</span>
<span class="sd">        :param kwargs: Other optional parameters to be passed to the estimating method.</span>

<span class="sd">        :returns: p-value from the significance test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signif_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">test_significance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="n">signif_results</span><span class="p">[</span><span class="s2">&quot;p_value&quot;</span><span class="p">]}</span></div>

<div class="viewcode-block" id="CausalEstimate.estimate_conditional_effects"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.estimate_conditional_effects">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_conditional_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">effect_modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">num_quantiles</span><span class="o">=</span><span class="n">CausalEstimator</span><span class="o">.</span><span class="n">NUM_QUANTILES_TO_DISCRETIZE_CONT_COLS</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate treatment effect conditioned on given variables.</span>

<span class="sd">        If a numeric effect modifier is provided, it is discretized into quantile bins. If you would like a custom discretization, you can do so yourself: create a new column containing the discretized effect modifier and then include that column&#39;s name in the effect_modifier_names argument.</span>

<span class="sd">        :param effect_modifiers: Names of effect modifier variables over which the conditional effects will be estimated. If not provided, defaults to the effect modifiers specified during creation of the CausalEstimator object.</span>
<span class="sd">        :param num_quantiles: The number of quantiles into which a numeric effect modifier variable is discretized. Does not affect any categorical effect modifiers.</span>

<span class="sd">        :returns: A (multi-index) dataframe that provides separate effects for each value of the (discretized) effect modifiers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_estimate_conditional_effects</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_estimate_effect_fn</span><span class="p">,</span>
                <span class="n">effect_modifiers</span><span class="p">,</span> <span class="n">num_quantiles</span><span class="p">)</span></div>

<div class="viewcode-block" id="CausalEstimate.interpret"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.CausalEstimate.interpret">[docs]</a>    <span class="k">def</span> <span class="nf">interpret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpret the causal estimate.</span>

<span class="sd">        :param method_name: Method used (string) or a list of methods. If None, then the default for the specific estimator is used.</span>
<span class="sd">        :param kwargs:: Optional parameters that are directly passed to the interpreter method.</span>

<span class="sd">        :returns: None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">interpret_method</span>
        <span class="n">method_name_arr</span> <span class="o">=</span> <span class="n">parse_state</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_name_arr</span><span class="p">:</span>
            <span class="n">interpreter</span> <span class="o">=</span> <span class="n">interpreters</span><span class="o">.</span><span class="n">get_class_object</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="n">interpreter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">interpret</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;*** Causal Estimate ***</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Identified estimand</span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_estimand</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span><span class="n">only_target_estimand</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Realized estimand</span><span class="se">\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">realized_estimand_expr</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Target units: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">target_units_tostr</span><span class="p">())</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Estimate</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Mean value: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_significance_test</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;p-value: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">signif_results_tostr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_stat_significance</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_confidence_intervals</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Standard error: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_standard_error</span><span class="p">())</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{0}% c</span><span class="s2">onfidence interval: </span><span class="si">{1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">confidence_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_confidence_intervals</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_estimates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;### Conditional Estimates</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditional_estimates</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">effect_strength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Effect Strength</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Change in outcome attributable to treatment: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effect_strength</span><span class="p">[</span><span class="s2">&quot;fraction-effect&quot;</span><span class="p">])</span>
            <span class="c1">#s += &quot;Variance in outcome explained by treatment: {}\n&quot;.format(self.effect_strength[&quot;r-squared&quot;])</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="RealizedEstimand"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.RealizedEstimand">[docs]</a><span class="k">class</span> <span class="nc">RealizedEstimand</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">estimator_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_variable</span> <span class="o">=</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">treatment_variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcome_variable</span> <span class="o">=</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">outcome_variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backdoor_variables</span> <span class="o">=</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">get_backdoor_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrumental_variables</span> <span class="o">=</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">instrumental_variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimand_type</span> <span class="o">=</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">estimand_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimand_expression</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assumptions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span> <span class="o">=</span> <span class="n">estimator_name</span>

<div class="viewcode-block" id="RealizedEstimand.update_assumptions"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.RealizedEstimand.update_assumptions">[docs]</a>    <span class="k">def</span> <span class="nf">update_assumptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator_assumptions</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assumptions</span> <span class="o">=</span> <span class="n">estimator_assumptions</span></div>

<div class="viewcode-block" id="RealizedEstimand.update_estimand_expression"><a class="viewcode-back" href="../../dowhy.html#dowhy.causal_estimator.RealizedEstimand.update_estimand_expression">[docs]</a>    <span class="k">def</span> <span class="nf">update_estimand_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimand_expression</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimand_expression</span> <span class="o">=</span> <span class="n">estimand_expression</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Realized estimand: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator_name</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Realized estimand type: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimand_type</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Estimand expression:</span><span class="se">\n</span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">pretty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimand_expression</span><span class="p">))</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ass_name</span><span class="p">,</span> <span class="n">ass_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumptions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Estimand assumption </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">: </span><span class="si">{2}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ass_name</span><span class="p">,</span> <span class="n">ass_str</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">s</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, PyWhy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.5
    <span class="fa fa-caret-down"></span>
  </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Releases</dt>
            <dd><a href="../../../v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
            <dd><a href="../../../v0.2/index.html">v0.2</a></dd>
            <dd><a href="../../../v0.4/index.html">v0.4</a></dd>
            <dd><a href="causal_estimator.html">v0.5</a></dd>
            <dd><a href="../../../v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="../../../v0.6/index.html">v0.6</a></dd>
            <dd><a href="../../../v0.7/index.html">v0.7</a></dd>
            <dd><a href="../../../v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="../../../v0.8/index.html">v0.8</a></dd>
            <!-- TODO: add mechanism to add new version here. Probably just render them in from generate_docs.sh. -->
        </dl>
        <dl>
            <dt>Branches</dt>
            <!-- hard-coding the link to main -->
            <!-- It would be nice if this opened the same page on main branch, but that seems to be overkill
                 right now. Therefore defaulting to the starting page (index). -->
            <dd><a href="/dowhy/main/index.html">main</a></dd>
        </dl>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>