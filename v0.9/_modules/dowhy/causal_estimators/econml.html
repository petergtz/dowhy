
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B139P18WHM');
    </script>
    
    <title>dowhy.causal_estimators.econml &#8212; DoWhy  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
    <img src="../../../_static/dowhy-logo-small.png" class="logo__image only-light" alt="Logo image">
    <img src="../../../_static/dowhy-logo-small.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../getting_started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../example_notebooks/nb_index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../dowhy.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../code_repo.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.9
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <h1>Source code for dowhy.causal_estimators.econml</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">numpy.distutils.misc_util</span> <span class="kn">import</span> <span class="n">is_sequence</span>

<span class="kn">from</span> <span class="nn">dowhy.causal_estimator</span> <span class="kn">import</span> <span class="n">CausalEstimate</span><span class="p">,</span> <span class="n">CausalEstimator</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_identifier</span> <span class="kn">import</span> <span class="n">IdentifiedEstimand</span>
<span class="kn">from</span> <span class="nn">dowhy.utils.api</span> <span class="kn">import</span> <span class="n">parse_state</span>


<span class="k">class</span> <span class="nc">_EconmlEstimator</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">effect_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">effect_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">shap_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="o">...</span>


<div class="viewcode-block" id="Econml"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml">[docs]</a><span class="k">class</span> <span class="nc">Econml</span><span class="p">(</span><span class="n">CausalEstimator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper class for estimators from the EconML library.</span>

<span class="sd">    Supports additional parameters as listed below. For init and fit</span>
<span class="sd">    parameters of each estimator, refer to the EconML docs.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">identified_estimand</span><span class="p">:</span> <span class="n">IdentifiedEstimand</span><span class="p">,</span>
        <span class="n">econml_estimator</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_EconmlEstimator</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">test_significance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">evaluate_effect_strength</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">confidence_intervals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_null_simulations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_SIMULATIONS_STAT_TEST</span><span class="p">,</span>
        <span class="n">num_simulations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_SIMULATIONS_CI</span><span class="p">,</span>
        <span class="n">sample_size_fraction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_SAMPLE_SIZE_FRACTION</span><span class="p">,</span>
        <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">DEFAULT_CONFIDENCE_LEVEL</span><span class="p">,</span>
        <span class="n">need_conditional_estimates</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">num_quantiles_to_discretize_cont_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">NUM_QUANTILES_TO_DISCRETIZE_CONT_COLS</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param identified_estimand: probability expression</span>
<span class="sd">            representing the target identified estimand to estimate.</span>
<span class="sd">        :param econml_methodname: Fully qualified name of econml estimator</span>
<span class="sd">            class. For example, &#39;econml.dml.DML&#39;</span>
<span class="sd">        :param test_significance: Binary flag or a string indicating whether to test significance and by which method. All estimators support test_significance=&quot;bootstrap&quot; that estimates a p-value for the obtained estimate using the bootstrap method. Individual estimators can override this to support custom testing methods. The bootstrap method supports an optional parameter, num_null_simulations. If False, no testing is done. If True, significance of the estimate is tested using the custom method if available, otherwise by bootstrap.</span>
<span class="sd">        :param evaluate_effect_strength: (Experimental) whether to evaluate the strength of effect</span>
<span class="sd">        :param confidence_intervals: Binary flag or a string indicating whether the confidence intervals should be computed and which method should be used. All methods support estimation of confidence intervals using the bootstrap method by using the parameter confidence_intervals=&quot;bootstrap&quot;. The bootstrap method takes in two arguments (num_simulations and sample_size_fraction) that can be optionally specified in the params dictionary. Estimators may also override this to implement their own confidence interval method. If this parameter is False, no confidence intervals are computed. If True, confidence intervals are computed by the estimator&#39;s specific method if available, otherwise through bootstrap</span>
<span class="sd">        :param num_null_simulations: The number of simulations for testing the</span>
<span class="sd">            statistical significance of the estimator</span>
<span class="sd">        :param num_simulations: The number of simulations for finding the</span>
<span class="sd">            confidence interval (and/or standard error) for a estimate</span>
<span class="sd">        :param sample_size_fraction: The size of the sample for the bootstrap</span>
<span class="sd">            estimator</span>
<span class="sd">        :param confidence_level: The confidence level of the confidence</span>
<span class="sd">            interval estimate</span>
<span class="sd">        :param need_conditional_estimates: Boolean flag indicating whether</span>
<span class="sd">            conditional estimates should be computed. Defaults to True if</span>
<span class="sd">            there are effect modifiers in the graph</span>
<span class="sd">        :param num_quantiles_to_discretize_cont_cols: The number of quantiles</span>
<span class="sd">            into which a numeric effect modifier is split, to enable</span>
<span class="sd">            estimation of conditional treatment effect over it.</span>
<span class="sd">        :param kwargs: (optional) Additional estimator-specific parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">identified_estimand</span><span class="o">=</span><span class="n">identified_estimand</span><span class="p">,</span>
            <span class="n">test_significance</span><span class="o">=</span><span class="n">test_significance</span><span class="p">,</span>
            <span class="n">evaluate_effect_strength</span><span class="o">=</span><span class="n">evaluate_effect_strength</span><span class="p">,</span>
            <span class="n">confidence_intervals</span><span class="o">=</span><span class="n">confidence_intervals</span><span class="p">,</span>
            <span class="n">num_null_simulations</span><span class="o">=</span><span class="n">num_null_simulations</span><span class="p">,</span>
            <span class="n">num_simulations</span><span class="o">=</span><span class="n">num_simulations</span><span class="p">,</span>
            <span class="n">sample_size_fraction</span><span class="o">=</span><span class="n">sample_size_fraction</span><span class="p">,</span>
            <span class="n">confidence_level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">,</span>
            <span class="n">need_conditional_estimates</span><span class="o">=</span><span class="n">need_conditional_estimates</span><span class="p">,</span>
            <span class="n">num_quantiles_to_discretize_cont_cols</span><span class="o">=</span><span class="n">num_quantiles_to_discretize_cont_cols</span><span class="p">,</span>
            <span class="n">econml_estimator</span><span class="o">=</span><span class="n">econml_estimator</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">econml_estimator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Using a string to specify the value for econml_estimator is now deprecated, please provide an instance of a econml object&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">estimator_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_econml_class_object</span><span class="p">(</span><span class="n">econml_estimator</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;init_params&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">econml_estimator</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;INFO: Using EconML Estimator&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span>

<div class="viewcode-block" id="Econml.fit"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">treatment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">outcome_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">effect_modifier_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the estimator with data for effect estimation</span>
<span class="sd">        :param data: data frame containing the data</span>
<span class="sd">        :param treatment: name of the treatment variable</span>
<span class="sd">        :param outcome: name of the outcome variable</span>
<span class="sd">        :param effect_modifiers: Variables on which to compute separate</span>
<span class="sd">                    effects, or return a heterogeneous effect function. Not all</span>
<span class="sd">                    methods support this currently.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">treatment_name</span><span class="p">,</span> <span class="n">outcome_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_effect_modifiers</span><span class="p">(</span><span class="n">effect_modifier_names</span><span class="p">)</span>

        <span class="c1"># Save parameters for later refutter fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_econml_fit_params</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">get_backdoor_variables</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Enforcing this ordering is necessary to feed through the propensity values from dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span> <span class="k">if</span> <span class="s2">&quot;propensity&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
        <span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span> <span class="k">if</span> <span class="s2">&quot;propensity&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>

        <span class="c1"># For metalearners only--issue a warning if w contains variables not in x</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;metalearners&quot;</span><span class="p">):</span>
            <span class="n">effect_modifier_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">effect_modifier_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">w_diff_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span> <span class="k">if</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">effect_modifier_names</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w_diff_x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Concatenating common_causes and effect_modifiers and providing a single list of variables to metalearner estimator method, &quot;</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="o">+</span> <span class="s2">&quot;. EconML metalearners accept a single X argument.&quot;</span>
                <span class="p">)</span>
                <span class="n">effect_modifier_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">w_diff_x</span><span class="p">)</span>
                <span class="c1"># Override the effect_modifiers set in CausalEstimator.__init__()</span>
                <span class="c1"># Also only update self._effect_modifiers, and create a copy of self._effect_modifier_names</span>
                <span class="c1"># the latter can be used by other estimator methods later</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">effect_modifier_names</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span> <span class="o">=</span> <span class="n">effect_modifier_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Effect modifiers: &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">effect_modifier_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Back-door variables used:&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span><span class="p">))</span>
        <span class="c1"># Instrumental variables names, if present</span>
        <span class="c1"># choosing the instrumental variable to use</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimating_instrument_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">instrumental_variables</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimating_instrument_names</span> <span class="o">=</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iv_instrument_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimating_instrument_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_estimating_instruments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">estimating_instrument_names</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_estimating_instruments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimating_instruments</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_estimating_instruments</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symbolic_estimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_symbolic_estimator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic_estimator</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">W</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># common causes/ confounders</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Instruments</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcome</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treatment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span><span class="p">:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimating_instrument_names</span><span class="p">:</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimating_instruments</span>
        <span class="n">named_data_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="n">W</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="n">Z</span><span class="p">}</span>

        <span class="c1"># Calling the econml estimator&#39;s fit method</span>
        <span class="n">estimator_argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">))</span>
        <span class="c1"># As of v0.9, econml has some kewyord only arguments</span>
        <span class="n">estimator_named_args</span> <span class="o">=</span> <span class="n">estimator_argspec</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">estimator_argspec</span><span class="o">.</span><span class="n">kwonlyargs</span>
        <span class="n">estimator_data_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">arg</span><span class="p">:</span> <span class="n">named_data_args</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">named_data_args</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">estimator_named_args</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">estimator_data_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_get_econml_class_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_method_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># from https://www.bnmetrics.com/blog/factory-pattern-in-python3-simple-version</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">module_method_name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">estimator_module</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
            <span class="n">estimator_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">estimator_module</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Error loading </span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">. Double-check the method name and ensure that all econml dependencies are installed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">module_name</span><span class="p">,</span> <span class="n">class_name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">estimator_class</span>

<div class="viewcode-block" id="Econml.estimate_effect"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.estimate_effect">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">treatment_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">control_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">target_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        data: dataframe containing the data on which treatment effect is to be estimated.</span>
<span class="sd">        treatment_value: value of the treatment variable for which the effect is to be estimated.</span>
<span class="sd">        control_value: value of the treatment variable that denotes its absence (usually 0)</span>
<span class="sd">        target_units: The units for which the treatment effect should be estimated.</span>
<span class="sd">                     It can be a DataFrame that contains values of the effect_modifiers and effect will be estimated only for this new data.</span>
<span class="sd">                     It can also be a lambda function that can be used as an index for the data (pandas DataFrame) to select the required rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_units</span> <span class="o">=</span> <span class="n">target_units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span> <span class="o">=</span> <span class="n">treatment_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control_value</span> <span class="o">=</span> <span class="n">control_value</span>

        <span class="n">n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treatment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Effect modifiers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifiers</span>

        <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span>
        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target_units</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
                <span class="n">X_test</span> <span class="o">=</span> <span class="n">target_units</span>
            <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">target_units</span><span class="p">):</span>
                <span class="n">filtered_rows</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">target_units</span><span class="p">)</span>
                <span class="n">boolean_criterion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_rows</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">boolean_criterion</span><span class="p">]</span>
        <span class="c1"># Changing shape to a list for a singleton value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span> <span class="o">=</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span><span class="p">)</span>

        <span class="n">est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effect</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">ate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># one value per treatment value</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ate</span> <span class="o">=</span> <span class="n">ate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence_intervals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">effect_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effect_interval</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">effect_intervals</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">estimate</span> <span class="o">=</span> <span class="n">CausalEstimate</span><span class="p">(</span>
            <span class="n">estimate</span><span class="o">=</span><span class="n">ate</span><span class="p">,</span>
            <span class="n">control_value</span><span class="o">=</span><span class="n">control_value</span><span class="p">,</span>
            <span class="n">treatment_value</span><span class="o">=</span><span class="n">treatment_value</span><span class="p">,</span>
            <span class="n">target_estimand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">,</span>
            <span class="n">realized_estimand_expr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic_estimator</span><span class="p">,</span>
            <span class="n">cate_estimates</span><span class="o">=</span><span class="n">est</span><span class="p">,</span>
            <span class="n">effect_intervals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effect_intervals</span><span class="p">,</span>
            <span class="n">_estimator_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">estimate</span><span class="o">.</span><span class="n">add_estimator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">estimate</span></div>

    <span class="k">def</span> <span class="nf">_estimate_confidence_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confidence_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns None if the confidence interval has not been calculated.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">effect_intervals</span>

    <span class="k">def</span> <span class="nf">_do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="Econml.construct_symbolic_estimator"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.construct_symbolic_estimator">[docs]</a>    <span class="k">def</span> <span class="nf">construct_symbolic_estimator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimand</span><span class="p">):</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="s2">&quot;b: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">estimand</span><span class="o">.</span><span class="n">outcome_variable</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;~&quot;</span>
        <span class="c1"># TODO -- fix: we are actually conditioning on positive treatment (d=1)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;metalearners&quot;</span><span class="p">):</span>
            <span class="n">var_list</span> <span class="o">=</span> <span class="n">estimand</span><span class="o">.</span><span class="n">treatment_variable</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span>
            <span class="n">expr</span> <span class="o">+=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var_list</span> <span class="o">=</span> <span class="n">estimand</span><span class="o">.</span><span class="n">treatment_variable</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observed_common_causes_names</span>
            <span class="n">expr</span> <span class="o">+=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var_list</span><span class="p">)</span>
            <span class="n">expr</span> <span class="o">+=</span> <span class="s2">&quot; | &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expr</span></div>

<div class="viewcode-block" id="Econml.shap_values"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.shap_values">[docs]</a>    <span class="k">def</span> <span class="nf">shap_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Econml.apply_multitreatment"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.apply_multitreatment">[docs]</a>    <span class="k">def</span> <span class="nf">apply_multitreatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">is_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">for</span> <span class="n">tv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span><span class="p">:</span>
            <span class="n">ests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">fun</span><span class="p">(</span>
                    <span class="n">filtered_df</span><span class="p">,</span>
                    <span class="n">T0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_control_value</span><span class="p">,</span>
                    <span class="n">T1</span><span class="o">=</span><span class="n">tv</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">ests</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">est</span></div>

<div class="viewcode-block" id="Econml.effect"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.effect">[docs]</a>    <span class="k">def</span> <span class="nf">effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pointwise estimated treatment effect,</span>
<span class="sd">        output shape n_units x n_treatment_values (not counting control)</span>
<span class="sd">        :param df: Features of the units to evaluate</span>
<span class="sd">        :param args: passed through to the underlying estimator</span>
<span class="sd">        :param kwargs: passed through to the underlying estimator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">effect_fun</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">effect</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="o">=</span><span class="n">T1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multitreatment</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">effect_fun</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Econml.effect_interval"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.effect_interval">[docs]</a>    <span class="k">def</span> <span class="nf">effect_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pointwise confidence intervals for the estimated treatment effect</span>
<span class="sd">        :param df: Features of the units to evaluate</span>
<span class="sd">        :param args: passed through to the underlying estimator</span>
<span class="sd">        :param kwargs: passed through to the underlying estimator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">effect_interval_fun</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">effect_interval</span><span class="p">(</span>
                <span class="n">filtered_df</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="o">=</span><span class="n">T1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">confidence_level</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multitreatment</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">effect_interval_fun</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Econml.effect_inference"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.effect_inference">[docs]</a>    <span class="k">def</span> <span class="nf">effect_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inference (uncertainty) results produced by the underlying EconML estimator</span>
<span class="sd">        :param df: Features of the units to evaluate</span>
<span class="sd">        :param args: passed through to the underlying estimator</span>
<span class="sd">        :param kwargs: passed through to the underlying estimator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">effect_inference_fun</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">effect_inference</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="o">=</span><span class="n">T1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multitreatment</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">effect_inference_fun</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Econml.effect_tt"><a class="viewcode-back" href="../../../dowhy.causal_estimators.html#dowhy.causal_estimators.econml.Econml.effect_tt">[docs]</a>    <span class="k">def</span> <span class="nf">effect_tt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Effect of the actual treatment that was applied to each unit</span>
<span class="sd">        (&quot;effect of Treatment on the Treated&quot;)</span>
<span class="sd">        :param df: Features of the units to evaluate</span>
<span class="sd">        :param args: passed through to estimator.effect()</span>
<span class="sd">        :param kwargs: passed through to estimator.effect()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span><span class="p">)))</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
        <span class="n">treatment_value</span> <span class="o">=</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_value</span><span class="p">)</span>
        <span class="n">treatment_name</span> <span class="o">=</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">eff</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">treatment_value</span><span class="p">)))</span>

        <span class="c1"># For each unit, return the estimated effect of the treatment value</span>
        <span class="c1"># that was actually applied to the unit</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">treatment_value</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">eff</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div></div>
</pre></div>

              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PyWhy contributors.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>