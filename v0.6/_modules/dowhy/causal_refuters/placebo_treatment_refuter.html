<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B139P18WHM');
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dowhy.causal_refuters.placebo_treatment_refuter &mdash; DoWhy  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> DoWhy
          </a>
              <div class="version">
                v0.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introducing DoWhy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">DoWhy | An end-to-end library for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#graphical-models-and-potential-outcomes-best-of-both-worlds">Graphical Models and Potential Outcomes: Best of both worlds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#four-steps-of-causal-inference">Four steps of causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#citing-this-package">Citing this package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#roadmap">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#contributing">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick-Start Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/tutorial-causalinference-machinelearning-using-dowhy-econml.html">Tutorial on Causal Inference and its Connections to Machine Learning (Using DoWhy+EconML)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Starter Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_simple_example.html">Getting started with DoWhy: A simple example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_confounder_example.html">Confounding Example: Finding causal effects from observed data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_estimation_methods.html">DoWhy: Different estimation methods for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy-simple-iv-example.html">Simple example on using Instrumental Variables method for estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/load_graph_example.html">Different ways to load an input graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_causal_api.html">Demo for the DoWhy causal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/do_sampler_demo.html">Do-sampler Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Case Study Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/DoWhy-The%20Causal%20Story%20Behind%20Hotel%20Booking%20Cancellations.html">DoWhy-The Causal Story Behind Hotel Booking Cancellations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_example_effect_of_memberrewards_program.html">Estimating the effect of a Member Rewards program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_ihdp_data_example.html">DoWhy example on ihdp (Infant Health and Development Program) dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_lalonde_example.html">DoWhy example on the Lalonde dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_refutation_testing.html">Applying refutation tests to the Lalonde and IHDP datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/lalonde_pandas_api.html">Lalonde Pandas API Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy-conditional-treatment-effects.html">Conditional Average Treatment Effects (CATE) with DoWhy and EconML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_mediation_analysis.html">Mediation analysis with DoWhy: Direct and Indirect Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_demo_dummy_outcome_refuter.html">A Simple Example on Creating a Custom Refutation Using User-Defined Outcome Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_multiple_treatments.html">Estimating effect of multiple treatments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example_notebooks/dowhy_refuter_notebook.html">Iterating over multiple refutation tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code_repo.html">Code repository &amp; Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dowhy.html">dowhy package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">DoWhy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
          <li><a href="../causal_refuters.html">dowhy.causal_refuters</a> &raquo;</li>
      <li>dowhy.causal_refuters.placebo_treatment_refuter</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dowhy.causal_refuters.placebo_treatment_refuter</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">dowhy.causal_refuter</span> <span class="kn">import</span> <span class="n">CausalRefutation</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_refuter</span> <span class="kn">import</span> <span class="n">CausalRefuter</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_estimator</span> <span class="kn">import</span> <span class="n">CausalEstimator</span><span class="p">,</span> <span class="n">CausalEstimate</span>
<span class="kn">from</span> <span class="nn">dowhy.utils.api</span> <span class="kn">import</span> <span class="n">parse_state</span>

<div class="viewcode-block" id="PlaceboTreatmentRefuter"><a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.placebo_treatment_refuter.PlaceboTreatmentRefuter">[docs]</a><span class="k">class</span> <span class="nc">PlaceboTreatmentRefuter</span><span class="p">(</span><span class="n">CausalRefuter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Refute an estimate by replacing treatment with a randomly-generated placebo variable.</span>

<span class="sd">    Supports additional parameters that can be specified in the refute_estimate() method.</span>

<span class="sd">    :param placebo_type: Default is to generate random values for the treatment. If placebo_type is &quot;permute&quot;, then the original treatment values are permuted by row.</span>
<span class="sd">    :type placebo_type: str, optional</span>

<span class="sd">    :param num_simulations: The number of simulations to be run, which is ``CausalRefuter.DEFAULT_NUM_SIMULATIONS`` by default</span>
<span class="sd">    :type num_simulations: int, optional</span>

<span class="sd">    :param random_state: The seed value to be added if we wish to repeat the same random behavior. If we want to repeat the same behavior we push the same seed in the psuedo-random generator.</span>
<span class="sd">    :type random_state: int, RandomState, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Default value of the p value taken for the distribution</span>
    <span class="n">DEFAULT_PROBABILITY_OF_BINOMIAL</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="c1"># Number of Trials: Number of cointosses to understand if a sample gets the treatment</span>
    <span class="n">DEFAULT_NUMBER_OF_TRIALS</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Mean of the Normal Distribution</span>
    <span class="n">DEFAULT_MEAN_OF_NORMAL</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Standard Deviation of the Normal Distribution</span>
    <span class="n">DEFAULT_STD_DEV_OF_NORMAL</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;placebo_type&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">=</span> <span class="s2">&quot;Random Data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_simulations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;num_simulations&quot;</span><span class="p">,</span><span class="n">CausalRefuter</span><span class="o">.</span><span class="n">DEFAULT_NUM_SIMULATIONS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;random_state&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="PlaceboTreatmentRefuter.refute_estimate"><a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.placebo_treatment_refuter.PlaceboTreatmentRefuter.refute_estimate">[docs]</a>    <span class="k">def</span> <span class="nf">refute_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># only permute is supported for iv methods</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">!=</span> <span class="s2">&quot;permute&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Only placebo_type=&#39;&#39;permute&#39;&#39; is supported for creating placebo for instrumental variable estimation methods&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only placebo_type=&#39;&#39;permute&#39;&#39; is supported for creating placebo for instrumental variable estimation methods.&quot;</span><span class="p">)</span>

        <span class="c1"># We need to change the identified estimand</span>
        <span class="c1"># We make a copy as a safety measure, we don&#39;t want to change the</span>
        <span class="c1"># original DataFrame</span>
        <span class="n">identified_estimand</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">)</span>
        <span class="n">identified_estimand</span><span class="o">.</span><span class="n">treatment_variable</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;placebo&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
            <span class="n">identified_estimand</span><span class="o">.</span><span class="n">instrumental_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;placebo_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">instrumental_variables</span><span class="p">]</span>
            <span class="c1"># For IV methods, the estimating_instrument_names should also be</span>
            <span class="c1"># changed. So we change it inside the estimate and then restore it</span>
            <span class="c1"># back at the end of this method.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;iv_instrument_name&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">[</span><span class="s2">&quot;placebo_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">])]</span>

        <span class="n">sample_estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_simulations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Refutation over </span><span class="si">{}</span><span class="s2"> simulated datasets of </span><span class="si">{}</span><span class="s2"> treatment&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_simulations</span>
                        <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span><span class="p">)</span>
                        <span class="p">)</span>

        <span class="n">num_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">treatment_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Extract the name of the treatment variable</span>
        <span class="n">type_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtypes</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_simulations</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">==</span> <span class="s2">&quot;permute&quot;</span><span class="p">:</span>
                <span class="n">permuted_idx</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">permuted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">permuted_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">new_treatment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">permuted_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
                    <span class="n">new_instruments_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">estimating_instrument_names</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">permuted_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="n">new_instruments_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_instruments_values</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;placebo_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">estimating_instrument_names</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;float&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Normal Distribution with Mean:</span><span class="si">{}</span><span class="s2"> and Variance:</span><span class="si">{}</span><span class="s2">&quot;</span>
                                     <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_MEAN_OF_NORMAL</span>
                                     <span class="p">,</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_STD_DEV_OF_NORMAL</span><span class="p">)</span>
                                     <span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)</span><span class="o">*</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_STD_DEV_OF_NORMAL</span> <span class="o">+</span> \
                                    <span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_MEAN_OF_NORMAL</span>

                <span class="k">elif</span> <span class="s1">&#39;bool&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Binomial Distribution with </span><span class="si">{}</span><span class="s2"> trials and </span><span class="si">{}</span><span class="s2"> probability of success&quot;</span>
                                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_TRIALS</span>
                                    <span class="p">,</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_PROBABILITY_OF_BINOMIAL</span><span class="p">)</span>
                                    <span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_TRIALS</span><span class="p">,</span>
                                                       <span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_PROBABILITY_OF_BINOMIAL</span><span class="p">,</span>
                                                       <span class="n">num_rows</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

                <span class="k">elif</span> <span class="s1">&#39;int&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Discrete Uniform Distribution lying between </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                    <span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                                      <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                                                      <span class="n">size</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>

                <span class="k">elif</span> <span class="s1">&#39;category&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Discrete Uniform Distribution with the following categories:</span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>
                    <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

            <span class="c1"># Create a new column in the data by the name of placebo</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">placebo</span><span class="o">=</span><span class="n">new_treatment</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_instruments_df</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Sanity check the data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">new_estimator</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">get_estimator_object</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">)</span>
            <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">()</span>
            <span class="n">sample_estimates</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Restoring the value of iv_instrument_name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;iv_instrument_name&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;placebo_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">])]</span>
        <span class="n">refute</span> <span class="o">=</span> <span class="n">CausalRefutation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample_estimates</span><span class="p">),</span>
                                  <span class="n">refutation_type</span><span class="o">=</span><span class="s2">&quot;Refute: Use a Placebo Treatment&quot;</span><span class="p">)</span>

        <span class="c1"># Note: We hardcode the estimate value to ZERO as we want to check if it falls in the distribution of the refuter</span>
        <span class="c1"># Ideally we should expect that ZERO should fall in the distribution of the effect estimates as we have severed any causal</span>
        <span class="c1"># relationship between the treatment and the outcome.</span>
        <span class="n">dummy_estimator</span> <span class="o">=</span> <span class="n">CausalEstimate</span><span class="p">(</span>
                <span class="n">estimate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">control_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">control_value</span><span class="p">,</span>
                <span class="n">treatment_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">treatment_value</span><span class="p">,</span>
                <span class="n">target_estimand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">target_estimand</span><span class="p">,</span>
                <span class="n">realized_estimand_expr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">realized_estimand_expr</span><span class="p">)</span>

        <span class="n">refute</span><span class="o">.</span><span class="n">add_significance_test_results</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_significance</span><span class="p">(</span><span class="n">dummy_estimator</span><span class="p">,</span> <span class="n">sample_estimates</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">refute</span><span class="o">.</span><span class="n">add_refuter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">refute</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, PyWhy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.6
    <span class="fa fa-caret-down"></span>
  </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Releases</dt>
            <dd><a href="../../../../v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
            <dd><a href="../../../../v0.2/index.html">v0.2</a></dd>
            <dd><a href="../../../../v0.4/index.html">v0.4</a></dd>
            <dd><a href="../../../../v0.5/index.html">v0.5</a></dd>
            <dd><a href="../../../../v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="placebo_treatment_refuter.html">v0.6</a></dd>
            <dd><a href="../../../../v0.7/index.html">v0.7</a></dd>
            <dd><a href="../../../../v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="../../../../v0.8/index.html">v0.8</a></dd>
            <!-- TODO: add mechanism to add new version here. Probably just render them in from generate_docs.sh. -->
        </dl>
        <dl>
            <dt>Branches</dt>
            <!-- hard-coding the link to main -->
            <!-- It would be nice if this opened the same page on main branch, but that seems to be overkill
                 right now. Therefore defaulting to the starting page (index). -->
            <dd><a href="/dowhy/main/index.html">main</a></dd>
        </dl>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>